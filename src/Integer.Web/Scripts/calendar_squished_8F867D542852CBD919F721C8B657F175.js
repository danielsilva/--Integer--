function initCalendar(n){Ext.onReady(function(){var t=810,i=new Date;Ext.create("Extensible.calendar.CalendarPanel",{eventStore:Ext.create("Extensible.calendar.data.MemoryEventStore",{data:n}),startDate:i,renderTo:"divCalendar",width:t,height:520,readOnly:!1,showMultiWeekView:!1,showNavJump:!0,todayText:"Hoje",jumpToText:"Navegar:",goText:"Ir",dayText:"Dia",weekText:"Semana",monthText:"Mês",listeners:{datechange:{fn:function(n,t){setCalendarTitle(t)},scope:this},dayclick:{fn:function(n,t,i,r){return showFormEvent(t,r),!1},scope:this}}}),$("#calendarTitle").width(t),$("#divCalendar").width(t),setCalendarTitle(i)})}function setCalendarTitle(n){$("#calendarTitle").html(Ext.Date.format(n,"F"))}function setDateTimePicker(){$.each($(".datetimeField"),function(){$(this).datetimepicker({hourMin:7,hourMax:22,hourGrid:2,minuteGrid:10,prevText:"",nextText:""})})}Ext.define("Extensible",{singleton:!0,version:"1.6.0-b1",versionDetails:{major:1,minor:6,patch:0},extVersion:"4.0.1",hasBorderRadius:Ext.supports.CSS3BorderRadius,log:function(){},getScrollWidth:function(){return Ext.getScrollbarSize?Ext.getScrollbarSize().width:Ext.getScrollBarWidth()},constructor:function(){Ext.onReady(function(){Extensible.getScrollWidth()<3&&Ext.getBody().addCls("x-no-scrollbar"),Ext.isWindows&&Ext.getBody().addCls("x-win");var n=Ext.getVersion();n.isLessThan("4.1")&&Ext.getBody().addCls("x-4-0")})},Date:{use24HourTime:!1,diff:function(n,t,i){var r=1,u=t.getTime()-n.getTime();return i==="s"||i==="seconds"?r=1e3:i==="m"||i==="minutes"?r=6e4:(i==="h"||i==="hours")&&(r=36e5),Math.round(u/r)},diffDays:function(n,t){var u=864e5,i=Ext.Date.clearTime,r=i(t,!0).getTime()-i(n,!0).getTime();return Math.ceil(r/u)},copyTime:function(n,t){var i=Ext.Date.clone(t);return i.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),i},compare:function(n,t,i){var u=n,r=t;return i!==!0&&(u=Ext.Date.clone(n),u.setMilliseconds(0),r=Ext.Date.clone(t),r.setMilliseconds(0)),r.getTime()-u.getTime()},maxOrMin:function(n){for(var i=n?0:Number.MAX_VALUE,t=0,r=arguments[1],u=r.length;t<u;t++)i=Math[n?"max":"min"](i,r[t].getTime());return new Date(i)},max:function(){return this.maxOrMin.apply(this,[!0,arguments])},min:function(){return this.maxOrMin.apply(this,[!1,arguments])},isInRange:function(n,t,i){return n>=t&&n<=i},rangesOverlap:function(n,t,i,r){var e=n>=i&&n<=r,f=t>=i&&t<=r,u=n<=i&&t>=r;return e||f||u},isWeekend:function(n){return n.getDay()%6==0},isWeekday:function(n){return n.getDay()%6!=0},isMidnight:function(n){return n.getHours()===0&&n.getMinutes()===0},isToday:function(n){return this.diffDays(n,this.today())===0},today:function(){return Ext.Date.clearTime(new Date)},add:function(n,t){if(!t)return n;var r=Ext.Date,u=r.add,i=r.clone(n);return t.years&&(i=u(i,r.YEAR,t.years)),t.months&&(i=u(i,r.MONTH,t.months)),t.weeks&&(t.days=(t.days||0)+t.weeks*7),t.days&&(i=u(i,r.DAY,t.days)),t.hours&&(i=u(i,r.HOUR,t.hours)),t.minutes&&(i=u(i,r.MINUTE,t.minutes)),t.seconds&&(i=u(i,r.SECOND,t.seconds)),t.millis&&(i=u(i,r.MILLI,t.millis)),t.clearTime?r.clearTime(i):i},clearTime:function(n,t){return Ext.Date.clearTime(n,t)}}}),Ext.require(["Ext.picker.Color","Ext.form.Basic","Ext.data.proxy.Memory"]),Extensible.applyOverrides=function(){Ext.DomHelper=Ext.core.DomHelper;var n=Ext.getVersion();Ext.layout.container.AbstractCard&&Ext.layout.container.AbstractCard.override({renderChildren:function(){this.deferredRender||(this.getActiveItem(),this.callParent())}}),Ext.Component.override({getId:function(){var t=this,n;return t.id||(n=t.getXType(),n=n?n.replace(/[\.,\s]/g,"-"):"ext-comp",t.id=n+"-"+t.getAutoId()),t.id}}),Ext.picker&&Ext.picker.Color&&Ext.picker.Color.override({constructor:function(){this.renderTpl=this.renderTpl||Ext.create("Ext.XTemplate",'<tpl for="colors"><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>'),this.callParent(arguments)}}),n.isLessThan("4.1")&&Ext.data&&Ext.data.reader&&Ext.data.reader.Reader&&Ext.data.reader.Reader.override({extractData:function(n){var t=this,f=[],e=[],h=t.model,r=0,s=n.length,c=t.getIdProperty(),i,o,u;for(!n.length&&Ext.isObject(n)&&(n=[n],s=1);r<s;r++)i=n[r],f=t.extractValues(i),o=t.getId(f),u=new h(f,o,i),e.push(u),t.implicitIncludes&&t.readAssociated(u,i);return e}}),Ext.form&&Ext.form.Basic&&Ext.form.Basic.override({reset:function(){var n=this;return n.getFields().each(function(n){n.reset()}),n}}),Ext.data&&Ext.data.proxy&&Ext.data.proxy.Memory&&Ext.data.proxy.Memory.override({updateOperation:function(n,t,i){Ext.each(n.records,function(n){n.commit()}),n.setCompleted(),n.setSuccessful(),Ext.callback(t,i||this,[n])},create:function(){this.updateOperation.apply(this,arguments)},update:function(){this.updateOperation.apply(this,arguments)},destroy:function(){this.updateOperation.apply(this,arguments)}}),n.isLessThan("4.1")&&Ext.form&&Ext.form.CheckboxGroup&&Ext.form.CheckboxGroup.override({resetOriginalValue:function(){var n=this;n.eachBox(function(n){n.resetOriginalValue()}),n.originalValue=n.getValue(),n.checkDirty()}})};Ext.onReady(Extensible.applyOverrides);Ext.define("Extensible.lang.Number",{statics:{getOrdinalSuffix:function(n){if(!Ext.isNumber(n))return"";switch(n){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}}}},function(){Extensible.Number=Extensible.lang.Number}),Ext.define("Extensible.data.Model",{extend:"Ext.data.Model",requires:["Ext.util.MixedCollection"],mappingClass:null,mappingIdProperty:null,inheritableStatics:{reconfigure:function(){var n=this.prototype,t=Ext.ClassManager.get(n.mappingClass||""),e=n.mappingIdProperty,u,i=[],r=0,f=0;if(!t)throw"The mappingClass for "+this.$className+" is undefined or invalid";n.idProperty=e||n.idProperty||"id";for(u in t)t.hasOwnProperty(u)&&i.push(t[u]);for(n.fields.clear(),f=i.length;r<f;r++)n.fields.add(Ext.create("Ext.data.Field",i[r]));return this}},clone:function(n){var i=Ext.create(this.$className),t=this.persistenceProperty;return i[t]=Ext.Object.merge({},this[t]),n!==!0&&delete i[t][this.idProperty],i}});
/*!
 * Extensible 1.6.0-b1
 * Copyright(c) 2010-2012 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */
Ext.define("Extensible.form.recurrence.AbstractOption",{extend:"Ext.form.FieldContainer",mixins:{field:"Ext.form.field.Field"},layout:"hbox",defaults:{margins:"0 5 0 0"},key:undefined,dateValueFormat:"Ymd\\THis\\Z",optionDelimiter:";",initComponent:function(){var n=this;n.addEvents("change"),n.startDate=n.startDate||new Date,n.items=n.getItemConfigs(),n.callParent(arguments),n.initRefs(),n.initField()},formatDate:function(n){return Ext.Date.format(n,this.dateValueFormat)},parseDate:function(n,t){t=t||{};try{var i=Ext.Date.parse(n,t.format||this.dateValueFormat,t.strict);if(i)return i}catch(r){}return t.defaultValue||new Date},afterRender:function(){this.callParent(arguments),this.updateLabel()},initRefs:Ext.emptyFn,setFrequency:function(n){this.frequency=n},setStartDate:function(n){return this.startDate=n,this},getStartDate:function(){return this.startDate||Extensible.Date.today()},getDefaultValue:function(){return""},preSetValue:function(n,t){var i=this;if(n||(n=i.getDefaultValue()),!t){i.on("afterrender",function(){i.setValue(n)},i,{single:!0});return!1}return i.value=n,!0}}),Ext.define("Extensible.form.recurrence.option.Duration",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-duration",requires:["Ext.form.Label","Ext.form.field.ComboBox","Ext.form.field.Number","Ext.form.field.Date"],minOccurrences:1,maxOccurrences:999,defaultEndDateOffset:5,minDateOffset:1,maxEndDate:new Date("12/31/9999"),endDateWidth:120,cls:"extensible-recur-duration",getItemConfigs:function(){var n=this,t=n.getStartDate();return[{xtype:"label",text:"and continuing"},{xtype:"combo",itemId:n.id+"-duration-combo",mode:"local",width:85,triggerAction:"all",forceSelection:!0,value:"forever",store:["forever","for","until"],listeners:{change:Ext.bind(n.onComboChange,n)}},{xtype:"datefield",itemId:n.id+"-duration-date",showToday:!1,width:n.endDateWidth,format:n.endDateFormat||Ext.form.field.Date.prototype.format,maxValue:n.maxEndDate,allowBlank:!1,hidden:!0,minValue:Ext.Date.add(t,Ext.Date.DAY,n.minDateOffset),value:n.getDefaultEndDate(t),listeners:{change:Ext.bind(n.onEndDateChange,n)}},{xtype:"numberfield",itemId:n.id+"-duration-num",value:5,width:55,minValue:n.minOccurrences,maxValue:n.maxOccurrences,allowBlank:!1,hidden:!0,listeners:{change:Ext.bind(n.onOccurrenceCountChange,n)}},{xtype:"label",itemId:n.id+"-duration-num-label",text:"occurrences",hidden:!0}]},initRefs:function(){var n=this;n.untilCombo=n.down("#"+n.id+"-duration-combo"),n.untilDateField=n.down("#"+n.id+"-duration-date"),n.untilNumberField=n.down("#"+n.id+"-duration-num"),n.untilNumberLabel=n.down("#"+n.id+"-duration-num-label")},onComboChange:function(n,t){this.toggleFields(t),this.checkChange()},toggleFields:function(n){var t=this;t.untilCombo.setValue(n),n==="until"?(t.untilDateField.getValue()||t.initUntilDate(),t.untilDateField.show()):(t.untilDateField.hide(),t.untilDateIsSet=!1),n==="for"?(t.untilNumberField.show(),t.untilNumberLabel.show()):(t.untilNumberField.hide(),t.untilNumberLabel.hide())},onOccurrenceCountChange:function(){this.checkChange()},onEndDateChange:function(){this.checkChange()},setStartDate:function(n){var t=this,i=t.getValue();return n.getTime()!==t.startDate.getTime()&&(t.callParent(arguments),t.untilDateField.setMinValue(n),(!i||t.untilDateField.getValue()<n)&&t.initUntilDate(n)),t},setFrequency:function(){return this.callParent(arguments),this.initUntilDate(),this},initUntilDate:function(n){if(!this.untilDateIsSet){this.untilDateIsSet=!0;var t=this.getDefaultEndDate(n||this.getStartDate());this.untilDateField.setValue(t)}return this},getDefaultEndDate:function(n){var i={},t;switch(this.frequency){case"WEEKLY":case"WEEKDAYS":t="weeks";break;case"MONTHLY":t="months";break;case"YEARLY":t="years";break;default:t="days"}return i[t]=this.defaultEndDateOffset,Extensible.Date.add(n,i)},getValue:function(){var n=this;if(n.untilCombo){if(n.untilNumberField.isVisible())return"COUNT="+n.untilNumberField.getValue();if(n.untilDateField.isVisible())return"UNTIL="+n.formatDate(this.adjustUntilDateValue(n.untilDateField.getValue()))}return""},adjustUntilDateValue:function(n){return Extensible.Date.add(n,{days:1,seconds:-1})},setValue:function(n){var t=this,u,r,i;return t.preSetValue(n,t.untilCombo)?n?(u=Ext.isArray(n)?n:n.split(t.optionDelimiter),r=!1,Ext.each(u,function(n){if(i=n.split("="),i[0]==="COUNT"){t.untilNumberField.setValue(i[1]),t.toggleFields("for"),r=!0;return}if(i[0]==="UNTIL"){t.untilDateField.setValue(t.parseDate(i[1])),t.untilDateField.validate(),t.toggleFields("until"),r=!0;return}},t),r||t.toggleFields("forever"),t):(t.toggleFields("forever"),t):t}}),Ext.define("Extensible.form.recurrence.option.Interval",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-interval",dateLabelFormat:"l, F j",unit:"day",minValue:1,maxValue:999,cls:"extensible-recur-interval",getItemConfigs:function(){var n=this;return[{xtype:"label",text:"Repeat every"},{xtype:"numberfield",itemId:n.id+"-interval",value:1,width:55,minValue:n.minValue,maxValue:n.maxValue,allowBlank:!1,enableKeyEvents:!0,listeners:{change:Ext.bind(n.onIntervalChange,n)}},{xtype:"label",itemId:n.id+"-date-label"}]},initRefs:function(){var n=this;n.intervalField=n.down("#"+n.id+"-interval"),n.dateLabel=n.down("#"+n.id+"-date-label")},onIntervalChange:function(){this.checkChange(),this.updateLabel()},getValue:function(){return this.intervalField?"INTERVAL="+this.intervalField.getValue():""},setValue:function(n){var t=this,r,i;return t.preSetValue(n,t.intervalField)?n?(r=Ext.isArray(n)?n:n.split(t.optionDelimiter),Ext.each(r,function(n){if(i=n.split("="),i[0]==="INTERVAL"){t.intervalField.setValue(i[1]),t.updateLabel();return}},t),t):(t.intervalField.setValue(t.minValue),t):t},setStartDate:function(n){return this.startDate=n,this.updateLabel(),this},setUnit:function(n){return this.unit=n,this.updateLabel(),this},updateLabel:function(n){var t=this,i;return t.intervalField&&(i=t.intervalField.getValue()===1?"":"s",t.unit=n?n.toLowerCase():t.unit||"day",t.dateLabel&&t.dateLabel.update(t.unit+i+" beginning "+Ext.Date.format(t.getStartDate(),t.dateLabelFormat))),t}}),Ext.define("Extensible.form.recurrence.option.Monthly",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-monthly",requires:["Ext.form.field.ComboBox","Extensible.lang.Number"],cls:"extensible-recur-monthly",nthComboWidth:150,unit:"month",afterRender:function(){this.callParent(arguments),this.isYearly=this.unit==="year",this.initNthCombo()},getItemConfigs:function(){return[{xtype:"label",text:"on the"},{xtype:"combobox",itemId:this.id+"-nth-combo",queryMode:"local",width:this.nthComboWidth,triggerAction:"all",forceSelection:!0,displayField:"text",valueField:"value",store:Ext.create("Ext.data.ArrayStore",{fields:["text","value"],idIndex:0,data:[]}),listeners:{change:Ext.bind(this.onComboChange,this)}},{xtype:"label",text:"of each "+this.unit}]},initRefs:function(){this.nthCombo=this.down("#"+this.id+"-nth-combo")},onComboChange:function(){this.checkChange()},setStartDate:function(n){return n.getTime()!==this.startDate.getTime()&&(this.callParent(arguments),this.initNthCombo()),this},initNthCombo:function(){if(this.rendered){var t=this,s=t.nthCombo,o=s.store,n=t.getStartDate(),a=Ext.Date.getLastDateOfMonth(n).getDate(),v=Ext.Date.format(n,"jS")+" day",e=n.getDate(),h=Math.ceil(e/7),l=Ext.Date.format(n,"D").substring(0,2).toUpperCase(),y=h+Extensible.Number.getOrdinalSuffix(h)+Ext.Date.format(n," l"),u=t.isYearly?" in "+Ext.Date.format(n,"F"):"",f=t.isYearly?"BYMONTH="+Ext.Date.format(n,"n"):"",c=t.isYearly?t.optionDelimiter:"",i=[[v+u,t.isYearly?f:"BYMONTHDAY="+e],[y+u,f+c+"BYDAY="+h+l]],r=o.find("value",s.getValue());return a-e<7&&i.push(["last "+Ext.Date.format(n,"l")+u,f+c+"BYDAY=-1"+l]),a===e&&i.push(["last day"+u,f+c+"BYMONTHDAY=-1"]),o.removeAll(),s.clearValue(),o.loadData(i),r>i.length-1&&(r=i.length-1),s.setValue(o.getAt(r>-1?r:0).data.value),t}},getValue:function(){var n=this;return n.nthCombo?n.nthCombo.getValue():""},setValue:function(n){var t=this,u,f,r,i;return t.preSetValue(n,t.nthCombo)?n?(f=Ext.isArray(n)?n:n.split(t.optionDelimiter),i=[],Ext.each(f,function(n){r=n.split("="),r[0]==="BYMONTH"&&i.unshift(n),(r[0]==="BYMONTHDAY"||r[0]==="BYDAY")&&i.push(n)},t),i.length&&t.nthCombo.setValue(i.join(t.optionDelimiter)),t):(u=t.nthCombo.store.getAt(0),u&&t.nthCombo.setValue(u.data.value),t):t}}),Ext.define("Extensible.form.recurrence.option.Weekly",{extend:"Extensible.form.recurrence.AbstractOption",alias:"widget.extensible.recurrence-weekly",requires:["Ext.form.field.Checkbox","Ext.form.CheckboxGroup"],dayValueDelimiter:",",cls:"extensible-recur-weekly",getItemConfigs:function(){var n=this.id;return[{xtype:"label",text:"on:"},{xtype:"checkboxgroup",itemId:n+"-days",flex:1,items:[{boxLabel:"Sun",name:"SU",id:n+"-SU"},{boxLabel:"Mon",name:"MO",id:n+"-MO"},{boxLabel:"Tue",name:"TU",id:n+"-TU"},{boxLabel:"Wed",name:"WE",id:n+"-WE"},{boxLabel:"Thu",name:"TH",id:n+"-TH"},{boxLabel:"Fri",name:"FR",id:n+"-FR"},{boxLabel:"Sat",name:"SA",id:n+"-SA"}],listeners:{change:Ext.bind(this.onSelectionChange,this)}}]},initValue:function(){this.callParent(arguments),this.value||this.selectByDate()},initRefs:function(){this.daysCheckboxGroup=this.down("#"+this.id+"-days")},onSelectionChange:function(){this.checkChange(),this.updateLabel()},selectByDate:function(n){var t=Ext.Date.format(n||this.getStartDate(),"D").substring(0,2).toUpperCase();this.setValue("BYDAY="+t)},clearValue:function(){this.value=undefined,this.daysCheckboxGroup&&this.daysCheckboxGroup.setValue({SU:0,MO:0,TU:0,WE:0,TH:0,FR:0,SA:0})},getValue:function(){var i=this,r,n,t;if(i.daysCheckboxGroup){r=i.daysCheckboxGroup.getValue(),n=[];for(t in r)r.hasOwnProperty(t)&&n.push(t);return n.length>0?"BYDAY="+n.join(i.dayValueDelimiter):""}return""},setValue:function(n){var t=this,f,i,r,u;return t.preSetValue(n,t.daysCheckboxGroup)?n?(f=Ext.isArray(n)?n:n.split(t.optionDelimiter),i={},Ext.each(f,function(n){if(r=n.split("="),r[0]==="BYDAY"){u=r[1].split(t.dayValueDelimiter),Ext.each(u,function(n){i[n]=!0},t),t.daysCheckboxGroup.setValue(i);return}},t),t):(t.daysCheckboxGroup.setValue(null),t):t}}),Ext.define("Extensible.form.recurrence.option.Yearly",{extend:"Extensible.form.recurrence.option.Monthly",alias:"widget.extensible.recurrence-yearly",cls:"extensible-recur-yearly",nthComboWidth:200,unit:"year"}),Ext.define("Extensible.form.recurrence.FrequencyCombo",{extend:"Ext.form.ComboBox",alias:"widget.extensible.recurrence-frequency",requires:["Ext.data.ArrayStore"],fieldLabel:"Repeats",queryMode:"local",triggerAction:"all",forceSelection:!0,displayField:"pattern",valueField:"id",cls:"extensible-recur-frequency",frequencyText:{none:"Does not repeat",daily:"Daily",weekdays:"Every weekday (Mon-Fri)",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"},initComponent:function(){var n=this;n.addEvents("frequencychange"),n.frequencyOptions=n.frequencyOptions||[["NONE",n.frequencyText.none],["DAILY",n.frequencyText.daily],["WEEKDAYS",n.frequencyText.weekdays],["WEEKLY",n.frequencyText.weekly],["MONTHLY",n.frequencyText.monthly],["YEARLY",n.frequencyText.yearly]],n.store=n.store||Ext.create("Ext.data.ArrayStore",{fields:["id","pattern"],idIndex:0,data:n.frequencyOptions});n.on("select",n.onSelect,n);n.callParent(arguments)},onSelect:function(n,t){this.fireEvent("frequencychange",t[0].data.id)}}),Ext.define("Extensible.form.recurrence.Fieldset",{extend:"Ext.form.FieldContainer",alias:"widget.extensible.recurrencefield",mixins:{field:"Ext.form.field.Field"},requires:["Ext.form.Label","Extensible.form.recurrence.FrequencyCombo","Extensible.form.recurrence.option.Interval","Extensible.form.recurrence.option.Weekly","Extensible.form.recurrence.option.Monthly","Extensible.form.recurrence.option.Yearly","Extensible.form.recurrence.option.Duration"],options:["daily","weekly","weekdays","monthly","yearly"],displayStyle:"field",fieldLabel:"Repeats",fieldContainerWidth:400,startDate:Ext.Date.clearTime(new Date),monitorChanges:!0,cls:"extensible-recur-field",frequencyWidth:null,layout:"anchor",defaults:{anchor:"100%"},initComponent:function(){var n=this;n.height&&n.displayStyle!=="field"||(delete n.height,n.autoHeight=!0),n.items=[{xtype:"extensible.recurrence-frequency",hideLabel:!0,width:this.frequencyWidth,itemId:this.id+"-frequency",listeners:{frequencychange:{fn:this.onFrequencyChange,scope:this}}},{xtype:"container",itemId:this.id+"-inner-ct",cls:"extensible-recur-inner-ct",autoHeight:!0,layout:"anchor",hideMode:"offsets",hidden:!0,width:this.fieldContainerWidth,defaults:{hidden:!0},items:[{xtype:"extensible.recurrence-interval",itemId:this.id+"-interval"},{xtype:"extensible.recurrence-weekly",itemId:this.id+"-weekly"},{xtype:"extensible.recurrence-monthly",itemId:this.id+"-monthly"},{xtype:"extensible.recurrence-yearly",itemId:this.id+"-yearly"},{xtype:"extensible.recurrence-duration",itemId:this.id+"-duration"}]}],n.callParent(arguments),n.initField()},afterRender:function(){this.callParent(arguments),this.initRefs()},initRefs:function(){var n=this,t=n.id;n.innerContainer=n.down("#"+t+"-inner-ct"),n.frequencyCombo=n.down("#"+t+"-frequency"),n.intervalField=n.down("#"+t+"-interval"),n.weeklyField=n.down("#"+t+"-weekly"),n.monthlyField=n.down("#"+t+"-monthly"),n.yearlyField=n.down("#"+t+"-yearly"),n.durationField=n.down("#"+t+"-duration"),n.initChangeEvents()},initChangeEvents:function(){var n=this;n.intervalField.on("change",n.onChange,n);n.weeklyField.on("change",n.onChange,n);n.monthlyField.on("change",n.onChange,n);n.yearlyField.on("change",n.onChange,n);n.durationField.on("change",n.onChange,n)},onChange:function(){this.fireEvent("change",this,this.getValue())},onFrequencyChange:function(n){this.setFrequency(n),this.onChange()},initValue:function(){var n=this;n.originalValue=n.lastValue=n.value,n.suspendCheckChange++,n.setStartDate(n.startDate),n.value!==undefined?n.setValue(n.value):n.frequency!==undefined?n.setValue("FREQ="+n.frequency):n.setValue(""),n.suspendCheckChange--,Ext.defer(n.doLayout,1,n),n.onChange()},setStartDate:function(n){var t=this;if(t.startDate=n,t.innerContainer)t.innerContainer.items.each(function(t){t.setStartDate&&t.setStartDate(n)});else t.on("afterrender",function(){t.setStartDate(n)},t,{single:!0});return t},getStartDate:function(){return this.startDate},isRecurring:function(){return this.getValue()!==""},getValue:function(){if(!this.innerContainer)return this.value;if(this.frequency==="NONE")return"";var n,t;return n=this.frequency==="WEEKDAYS"?["FREQ=WEEKLY","BYDAY=MO,TU,WE,TH,FR"]:["FREQ="+this.frequency],this.innerContainer.items.each(function(i){i.isVisible()&&i.getValue&&(t=i.getValue(),this.includeItemValue(t)&&n.push(t))},this),n.length>1?n.join(";"):n[0]},includeItemValue:function(n){if(n){if(n==="INTERVAL=1")return!1;var t=Ext.Date.format(this.startDate,"D").substring(0,2).toUpperCase();return n==="BYDAY="+t?!1:!0}return!1},getDescription:function(){var t=this.getValue(),n="";return"Friendly text : "+n},setValue:function(n){var t=this,i;if(t.value=!n||n==="NONE"?"":n,!t.frequencyCombo||!t.innerContainer){t.on("afterrender",function(){t.setValue(n)},t,{single:!0});return}return i=t.value.split(";"),t.value===""?t.setFrequency("NONE"):Ext.each(i,function(n){if(n.indexOf("FREQ")>-1){var i=n.split("=")[1];t.setFrequency(i),t.checkChange();return}},t),t.innerContainer.items.each(function(n){n.setValue&&n.setValue(t.value)}),t.checkChange(),t},setFrequency:function(n){var t=this;if(t.frequency=n,t.frequencyCombo)t.frequencyCombo.setValue(n),t.showOptions(n),this.innerContainer.items.each(function(t){t.setFrequency(n)});else t.on("afterrender",function(){t.frequencyCombo.setValue(n),t.showOptions(n)},t,{single:!0});return t},showOptions:function(n){var t=this,i="day";n==="NONE"?t.innerContainer.hide():(t.intervalField.show(),t.durationField.show(),t.innerContainer.show());switch(n){case"DAILY":case"WEEKDAYS":t.weeklyField.hide(),t.monthlyField.hide(),t.yearlyField.hide(),n==="WEEKDAYS"&&(i="week");break;case"WEEKLY":t.weeklyField.show(),t.monthlyField.hide(),t.yearlyField.hide(),i="week";break;case"MONTHLY":t.monthlyField.show(),t.weeklyField.hide(),t.yearlyField.hide(),i="month";break;case"YEARLY":t.yearlyField.show(),t.weeklyField.hide(),t.monthlyField.hide(),i="year"}t.intervalField.updateLabel(i)}}),Ext.define("Extensible.form.recurrence.RangeEditPanel",{extend:"Ext.form.Panel",alias:"widget.extensible.recurrence-rangeeditpanel",cls:"extensible-recur-edit-options",headerText:"There are multiple events in this series. How would you like your changes applied?",optionSingleButtonText:"Single",optionSingleDescription:"Apply to this event only. No other events in the series will be affected.",optionFutureButtonText:"Future",optionFutureDescription:"Apply to this and all following events only. Past events will be unaffected.",optionAllButtonText:"All Events",optionAllDescription:"Apply to every event in this series.",editModes:{SINGLE:"single",FUTURE:"future",ALL:"all"},border:!1,layout:{type:"vbox",align:"stretch"},initComponent:function(){var n=this;n.editMode=n.editMode||n.editModes.ALL,n.items=[n.getHeaderConfig(),n.getOptionPanelConfig(),n.getSummaryConfig()],n.callParent(arguments)},getHeaderConfig:function(){return{xtype:"component",html:this.headerText,height:55,padding:15}},getSummaryConfig:function(){return{xtype:"component",itemId:this.id+"-summary",html:this.optionAllDescription,flex:1,padding:15}},getOptionPanelConfig:function(){return{xtype:"panel",border:!1,layout:{type:"hbox",pack:"center"},items:this.getOptionButtonConfigs()}},getOptionButtonConfigs:function(){var n=this,t={xtype:"button",iconAlign:"top",enableToggle:!0,scale:"large",width:80,toggleGroup:"recur-toggle",toggleHandler:n.onToggle,scope:n};return[Ext.apply({itemId:n.id+"-single",text:n.optionSingleButtonText,iconCls:"recur-edit-single",pressed:n.editMode===n.editModes.SINGLE},t),Ext.apply({itemId:n.id+"-future",text:n.optionFutureButtonText,iconCls:"recur-edit-future",pressed:n.editMode===n.editModes.FUTURE},t),Ext.apply({itemId:n.id+"-all",text:n.optionAllButtonText,iconCls:"recur-edit-all",pressed:n.editMode===n.editModes.ALL},t)]},getEditMode:function(){return this.editMode},showEditModes:function(n){n=n||[];var t=this,r=0,u,i=n.length;for(t.down("#"+t.id+"-single")[i?"hide":"show"](),t.down("#"+t.id+"-future")[i?"hide":"show"](),t.down("#"+t.id+"-all")[i?"hide":"show"]();r<i;r++)u=t.down("#"+t.id+"-"+n[r]),u&&u.show()},onToggle:function(n){var t=this,i=t.getComponent(t.id+"-summary").getEl();n.itemId===t.id+"-single"?(i.update(t.optionSingleDescription),t.editMode=t.editModes.SINGLE):n.itemId===t.id+"-future"?(i.update(t.optionFutureDescription),t.editMode=t.editModes.FUTURE):(i.update(t.optionAllDescription),t.editMode=t.editModes.ALL)}}),Ext.define("Extensible.form.recurrence.RangeEditWindow",{extend:"Ext.window.Window",alias:"widget.extensible.recurrence-rangeeditwindow",singleton:!0,requires:["Extensible.form.recurrence.RangeEditPanel"],title:"Recurring Event Options",width:350,height:240,saveButtonText:"Save",cancelButtonText:"Cancel",closeAction:"hide",modal:!0,resizable:!1,constrain:!0,buttonAlign:"right",layout:"fit",formPanelConfig:{border:!1},initComponent:function(){this.items=[{xtype:"extensible.recurrence-rangeeditpanel",itemId:this.id+"-recur-panel"}],this.fbar=this.getFooterBarConfig(),this.callParent(arguments)},getRangeEditPanel:function(){return this.down("#"+this.id+"-recur-panel")},prompt:function(n){this.callbackFunction=Ext.bind(n.callback,n.scope||this),this.getRangeEditPanel().showEditModes(n.editModes),this.show()},getFooterBarConfig:function(){return["->",{text:this.saveButtonText,itemId:this.id+"-save-btn",disabled:!1,handler:this.onSaveAction,scope:this},{text:this.cancelButtonText,itemId:this.id+"-cancel-btn",disabled:!1,handler:this.onCancelAction,scope:this}]},onSaveAction:function(){var n=this.getComponent(this.id+"-recur-panel").getEditMode();this.callbackFunction(n),this.close()},onCancelAction:function(){this.callbackFunction(!1),this.close()}});
/*!
 * Extensible 1.6.0-b1
 * Copyright(c) 2010-2012 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */
Ext.ns("Extensible.calendar.data"),Extensible.calendar.data.EventMappings={EventId:{name:"EventId",mapping:"id",type:"string"},CalendarId:{name:"CalendarId",mapping:"cid",type:"string"},Title:{name:"Title",mapping:"title",type:"string"},StartDate:{name:"StartDate",mapping:"start",type:"date",dateFormat:"c"},EndDate:{name:"EndDate",mapping:"end",type:"date",dateFormat:"c"},Location:{name:"Location",mapping:"loc",type:"string"},Notes:{name:"Notes",mapping:"notes",type:"string"},Url:{name:"Url",mapping:"url",type:"string"},IsAllDay:{name:"IsAllDay",mapping:"ad",type:"boolean"},Reminder:{name:"Reminder",mapping:"rem",type:"string"},RRule:{name:"RRule",mapping:"rrule",type:"string"},Duration:{name:"Duration",mapping:"duration",defaultValue:-1,type:"int"},OriginalEventId:{name:"OriginalEventId",mapping:"origid",type:"string"},RInstanceStartDate:{name:"RInstanceStartDate",mapping:"ristart",type:"date",dateFormat:"c"},REditMode:{name:"REditMode",mapping:"redit",type:"string"}},Ext.ns("Extensible.calendar.data"),Extensible.calendar.data.CalendarMappings={CalendarId:{name:"CalendarId",mapping:"id",type:"string"},Title:{name:"Title",mapping:"title",type:"string"},Description:{name:"Description",mapping:"desc",type:"string"},ColorId:{name:"ColorId",mapping:"color",type:"int"},IsHidden:{name:"IsHidden",mapping:"hidden",type:"boolean"}},Ext.define("Extensible.calendar.template.BoxLayout",{extend:"Ext.XTemplate",requires:["Ext.Date"],firstWeekDateFormat:"D j",otherWeeksDateFormat:"j",singleDayDateFormat:"l, F j, Y",multiDayFirstDayFormat:"M j, Y",multiDayMonthStartFormat:"M j",constructor:function(n){Ext.apply(this,n);var t=this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"";Extensible.calendar.template.BoxLayout.superclass.constructor.call(this,'<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',t,'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&#160;</td>',"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(n,t){return(n-1)*(100/t)},getRowHeight:function(n){return 100/n}})},applyTemplate:function(n){var f,c;Ext.apply(this,n);for(var i=0,e="",s=!0,u=!1,y=!1,h=!1,o=!1,a=!1,v=n.weekendCls,k=n.prevMonthCls,w=n.nextMonthCls,p=n.todayCls,r=[[]],b=Extensible.Date.today(),t=Ext.Date.clone(this.viewStart),l=this.startDate.getMonth();i<this.weekCount||this.weekCount==-1;i++){if(t>this.viewEnd)break;for(r[i]=[],f=0;f<this.dayCount;f++)u=t.getTime()===b.getTime(),y=s||t.getDate()==1,h=t.getMonth()<l&&this.weekCount==-1,o=t.getMonth()>l&&this.weekCount==-1,a=t.getDay()%6==0,t.getDay()==1&&(r[i].weekNum=this.showWeekNumbers?Ext.Date.format(t,"W"):"&#160;",r[i].weekLinkId="ext-cal-week-"+Ext.Date.format(t,"Ymd")),y?e=u?this.getTodayText():Ext.Date.format(t,this.dayCount==1?this.singleDayDateFormat:s?this.multiDayFirstDayFormat:this.multiDayMonthStartFormat):(c=i==0&&this.showHeader!==!0?this.firstWeekDateFormat:this.otherWeeksDateFormat,e=u?this.getTodayText():Ext.Date.format(t,c)),r[i].push({title:e,date:Ext.Date.clone(t),titleCls:"ext-cal-dtitle "+(u?" ext-cal-dtitle-today":"")+(i==0?" ext-cal-dtitle-first":"")+(h?" ext-cal-dtitle-prev":"")+(o?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(u?" "+p:"")+(f==0?" ext-cal-day-first":"")+(h?" "+k:"")+(o?" "+w:"")+(a&&v?" "+v:"")}),t=Extensible.Date.add(t,{days:1}),s=!1}return Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.BoxLayout.superclass.applyTemplate.call(this,{weeks:r}):this.applyOut({weeks:r},[]).join("")},getTodayText:function(){var r=Extensible.Date.use24HourTime?"G:i ":"g:ia ",t=this.showTodayText!==!1?this.todayText:"",n=this.showTime!==!1?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time" aria-live="off">'+Ext.Date.format(new Date,r)+"</span>":"",i=t.length>0||n.length>0?" &#8212; ":"";return this.dayCount==1?Ext.Date.format(new Date,this.singleDayDateFormat)+i+t+n:(fmt=this.weekCount==1?this.firstWeekDateFormat:this.otherWeeksDateFormat,t.length>0?t+n:Ext.Date.format(new Date,fmt)+n)}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Extensible.calendar.template.DayHeader",{extend:"Ext.XTemplate",requires:["Extensible.calendar.template.BoxLayout"],constructor:function(n){Ext.apply(this,n),this.allDayTpl=Ext.create("Extensible.calendar.template.BoxLayout",n),this.allDayTpl.compile(),Extensible.calendar.template.DayHeader.superclass.constructor.call(this,'<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tbody>","</table>","</div>")},applyTemplate:function(n){var t={allDayTpl:this.allDayTpl.apply(n)};return Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.DayHeader.superclass.applyTemplate.call(this,t):this.applyOut(t,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Extensible.calendar.template.DayBody",{extend:"Ext.XTemplate",constructor:function(n){Ext.apply(this,n),Extensible.calendar.template.DayBody.superclass.constructor.call(this,'<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0" style="height:{dayHeight}px;">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<div class="ext-cal-bg-row ext-row-{[xindex]}" style="height:{parent.hourHeight}px;">','<div class="ext-cal-bg-row-div {parent.hourSeparatorCls}" style="height:{parent.hourSeparatorHeight}px;"></div>',"</div>","</tpl>","</div>","</div>","</td>","</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row" style="height:{parent.hourHeight}px;">','<div class="ext-cal-day-time-inner"  style="height:{parent.hourHeight-1}px;">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<div class="ext-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="ext-cal-day-col-gutter" style="height:{parent.dayHeight}px;"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>")},applyTemplate:function(n){this.today=Extensible.Date.today(),this.dayCount=this.dayCount||1;for(var t=0,f=[],i=Ext.Date.clone(n.viewStart);t<this.dayCount;t++)f[t]=Extensible.Date.add(i,{days:t});var e=[],r=this.viewStartHour,o=this.viewEndHour,s=this.hourIncrement,c=this.hourHeight*(o-r),h=Extensible.Date.use24HourTime?"G:i":"ga",u;for(i=Extensible.Date.add(new Date("5/26/1972"),{hours:r}),t=r;t<o;t++)e.push(Ext.Date.format(i,h)),i=Extensible.Date.add(i,{minutes:s});return u={days:f,dayCount:f.length,times:e,hourHeight:this.hourHeight,hourSeparatorCls:this.showHourSeparator?"":"no-sep",dayHeight:c,hourSeparatorHeight:this.hourHeight/2},Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.DayBody.superclass.applyTemplate.call(this,u):this.applyOut(u,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Extensible.calendar.template.Month",{extend:"Ext.XTemplate",requires:["Extensible.calendar.template.BoxLayout"],dayHeaderFormat:"D",dayHeaderTitleFormat:"l, F j, Y",constructor:function(n){Ext.apply(this,n),this.weekTpl=Ext.create("Extensible.calendar.template.BoxLayout",n),this.weekTpl.compile();var t=this.showWeekLinks?'<div class="ext-cal-week-link-hd">&#160;</div>':"";Extensible.calendar.template.Month.superclass.constructor.call(this,'<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',t,'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{title}">{name}</th>',"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>")},applyTemplate:function(n){for(var f=[],s=this.weekTpl.apply(n),o=n.viewStart,e=Extensible.Date,i,r,u,t=0;t<7;t++)r=e.add(o,{days:t}),f.push({name:Ext.Date.format(r,this.dayHeaderFormat),title:Ext.Date.format(r,this.dayHeaderTitleFormat)});return u=this.showHeader===!0?"":"ext-cal-noheader",this.showWeekLinks&&(u+=" ext-cal-week-links"),i={days:f,weeks:s,extraClasses:u},Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.Month.superclass.applyTemplate.call(this,i):this.applyOut(i,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Ext.dd.ScrollManager",{singleton:!0,requires:["Ext.dd.DragDropManager"],constructor:function(){var n=Ext.dd.DragDropManager;n.fireEvents=Ext.Function.createSequence(n.fireEvents,this.onFire,this),n.stopDrag=Ext.Function.createSequence(n.stopDrag,this.onStop,this),this.doScroll=Ext.Function.bind(this.doScroll,this),this.ddmInstance=n,this.els={},this.dragEl=null,this.proc={}},onStop:function(){this.dragEl=null,this.clearProc()},triggerRefresh:function(){this.ddmInstance.dragCurrent&&this.ddmInstance.refreshCache(this.ddmInstance.dragCurrent.groups)},doScroll:function(){if(this.ddmInstance.dragCurrent){var n=this.proc,r=n.el,i=n.el.ddScrollConfig,t=i?i.increment:this.increment;this.animate?r.scroll(n.dir,t,!0,this.animDuration,this.triggerRefresh):r.scroll(n.dir,t)&&this.triggerRefresh()}},clearProc:function(){var n=this.proc;n.id&&clearInterval(n.id),n.id=0,n.el=null,n.dir=""},startProc:function(n,t){this.clearProc(),this.proc.el=n,this.proc.dir=t;var i=n.ddScrollConfig?n.ddScrollConfig.ddGroup:undefined,r=n.ddScrollConfig&&n.ddScrollConfig.frequency?n.ddScrollConfig.frequency:this.frequency;(i===undefined||this.ddmInstance.dragCurrent.ddGroup==i)&&(this.proc.id=setInterval(this.doScroll,r))},onFire:function(n,t){var s;if(!t&&this.ddmInstance.dragCurrent){this.dragEl&&this.dragEl==this.ddmInstance.dragCurrent||(this.dragEl=this.ddmInstance.dragCurrent,this.refreshCache());var h=n.getXY(),u=n.getPoint(),e=this.proc,o=this.els;for(s in o){var i=o[s],r=i._region,f=i.ddScrollConfig?i.ddScrollConfig:this;if(r&&r.contains(u)&&i.isScrollable()){if(r.bottom-u.y<=f.vthresh){e.el!=i&&this.startProc(i,"down");return}if(r.right-u.x<=f.hthresh){e.el!=i&&this.startProc(i,"left");return}if(u.y-r.top<=f.vthresh){e.el!=i&&this.startProc(i,"up");return}if(u.x-r.left<=f.hthresh){e.el!=i&&this.startProc(i,"right");return}}}this.clearProc()}},register:function(n){if(Ext.isArray(n))for(var t=0,i=n.length;t<i;t++)this.register(n[t]);else n=Ext.get(n),this.els[n.id]=n},unregister:function(n){if(Ext.isArray(n))for(var t=0,i=n.length;t<i;t++)this.unregister(n[t]);else n=Ext.get(n),delete this.els[n.id]},vthresh:25,hthresh:25,increment:100,frequency:500,animate:!0,animDuration:.4,ddGroup:undefined,refreshCache:function(){var t=this.els,n;for(n in t)typeof t[n]=="object"&&(t[n]._region=t[n].getRegion())}}),Ext.define("Extensible.calendar.dd.StatusProxy",{extend:"Ext.dd.StatusProxy",moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",renderTpl:['<div class="'+Ext.baseCSSPrefix+'dd-drop-icon"></div>','<div class="ext-dd-ghost-ct">','<div id="{id}-ghost" class="'+Ext.baseCSSPrefix+'dd-drag-ghost"></div>','<div id="{id}-message" class="ext-dd-msg"></div>',"</div>"],childEls:["ghost","message"],constructor:function(n){Ext.getVersion().isLessThan("4.1")?this.preComponentConstructor(n):this.callParent(arguments)},preComponentConstructor:function(n){var t=this;Ext.apply(t,n),t.id=t.id||Ext.id(),t.proxy=Ext.createWidget("component",{floating:!0,id:t.id||Ext.id(),html:t.renderTpl.join(""),cls:Ext.baseCSSPrefix+"dd-drag-proxy "+t.dropNotAllowed,shadow:!n||n.shadow!==!1,renderTo:document.body}),t.el=t.proxy.el,t.el.show(),t.el.setVisibilityMode(Ext.core.Element.VISIBILITY),t.el.hide(),t.ghost=Ext.get(t.el.dom.childNodes[1].childNodes[0]),t.message=Ext.get(t.el.dom.childNodes[1].childNodes[1]),t.dropStatus=t.dropNotAllowed},update:function(){this.callParent(arguments);var t=this.ghost.dom.firstChild;t&&Ext.fly(t).setHeight("auto")},updateMsg:function(n){this.message.update(n)}}),Ext.define("Extensible.calendar.dd.DragZone",{extend:"Ext.dd.DragZone",requires:["Extensible.calendar.dd.StatusProxy","Extensible.calendar.data.EventMappings"],ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",eventSelectorDepth:10,constructor:function(){Extensible.calendar._statusProxyInstance||(Extensible.calendar._statusProxyInstance=Ext.create("Extensible.calendar.dd.StatusProxy")),this.proxy=Extensible.calendar._statusProxyInstance,this.callParent(arguments)},getDragData:function(n){var t=n.getTarget(this.eventSelector,this.eventSelectorDepth),i;return t?(i=this.view.getEventRecordFromEl(t),!i)?void 0:{type:"eventdrag",ddel:t,eventStart:i.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:i.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}:(t=this.view.getDayAt(n.getX(),n.getY()),t.el)?{type:"caldrag",start:t.date,proxy:this.proxy}:null},onInitDrag:function(n,t){if(this.dragData.ddel){var i=this.dragData.ddel.cloneNode(!0),r=Ext.fly(i).down("dl");Ext.fly(i).setWidth("auto"),r&&r.setHeight("auto"),this.proxy.update(i);this.onStartDrag(n,t)}else if(this.dragData.start)this.onStartDrag(n,t);return this.view.onInitDrag(),!0},afterRepair:function(){Ext.enableFx&&this.dragData.ddel&&Ext.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9"),this.dragging=!1},getRepairXY:function(){if(this.dragData.ddel)return Ext.fly(this.dragData.ddel).getXY()},afterInvalidDrop:function(){Ext.select(".ext-dd-shim").hide()},destroy:function(){this.callParent(arguments),delete Extensible.calendar._statusProxyInstance}}),Ext.define("Extensible.calendar.dd.DropZone",{extend:"Ext.dd.DropZone",requires:["Ext.Layer","Extensible.calendar.data.EventMappings"],ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",shims:[],getTargetFromEvent:function(n){var i=this.dragOffset||0,r=n.getPageY()-i,t=this.view.getDayAt(n.getPageX(),r);return t.el?t:null},onNodeOver:function(n,t,i,r){var u=Extensible.Date,s=i.ctrlKey||i.altKey?this.copyText:this.moveText,e=r.type=="eventdrag"?n.date:u.min(r.start,n.date),f=r.type=="eventdrag"?u.add(n.date,{days:u.diffDays(r.eventStart,r.eventEnd)}):u.max(r.start,n.date),o;return this.dragStartDate&&this.dragEndDate&&u.diffDays(e,this.dragStartDate)==0&&u.diffDays(f,this.dragEndDate)==0||(this.dragStartDate=e,this.dragEndDate=u.add(f,{days:1,millis:-1,clearTime:!0}),this.shim(e,f),o=Ext.Date.format(e,this.dateFormat),u.diffDays(e,f)>0&&(f=Ext.Date.format(f,this.dateFormat),o=Ext.String.format(this.dateRangeFormat,o,f)),this.currentRange=o),r.proxy.updateMsg(Ext.String.format(r.type==="eventdrag"?s:this.createText,this.currentRange)),this.dropAllowed},shim:function(n,t){var f,u,i;this.currWeek=-1;var r=Ext.Date.clone(n),s=0,i,e,o=Extensible.Date,h=o.diffDays(r,t)+1;for(Ext.each(this.shims,function(n){n&&(n.isActive=!1)});s++<h;)f=this.view.getDayEl(r),f&&(u=this.view.getWeekIndex(r),i=this.shims[u],i||(i=this.createShim(),this.shims[u]=i),u!=this.currWeek?(i.boxInfo=f.getBox(),this.currWeek=u):(e=f.getBox(),i.boxInfo.right=e.right,i.boxInfo.width=e.right-i.boxInfo.x),i.isActive=!0),r=o.add(r,{days:1});Ext.each(this.shims,function(n){n&&(n.isActive?(n.show(),n.setBox(n.boxInfo)):n.isVisible()&&n.hide())})},createShim:function(){var t=this.view.ownerCalendarPanel?this.view.ownerCalendarPanel:this.view,n;return this.shimCt||(this.shimCt=Ext.get("ext-dd-shim-ct-"+t.id),this.shimCt||(this.shimCt=document.createElement("div"),this.shimCt.id="ext-dd-shim-ct-"+t.id,t.getEl().parent().appendChild(this.shimCt))),n=document.createElement("div"),n.className="ext-dd-shim",this.shimCt.appendChild(n),Ext.create("Ext.Layer",{shadow:!1,useDisplay:!0,constrain:!1},n)},clearShims:function(){Ext.each(this.shims,function(n){n&&n.hide()})},onContainerOver:function(){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate,delete this.dragEndDate,this.clearShims()},onNodeDrop:function(n,t,i,r){if(n&&r){if(r.type=="eventdrag"){var u=this.view.getEventRecordFromEl(r.ddel),f=Extensible.Date.copyTime(u.data[Extensible.calendar.data.EventMappings.StartDate.name],n.date);this.view.onEventDrop(u,f,i.ctrlKey||i.altKey?"copy":"move");return this.onCalendarDragComplete(),!0}if(r.type=="caldrag"){this.dragEndDate||(this.dragStartDate=Ext.Date.clearTime(r.start),this.dragEndDate=Extensible.Date.add(this.dragStartDate,{days:1,millis:-1,clearTime:!0}));this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this));return!0}}return this.onCalendarDragComplete(),!1},onContainerDrop:function(){return this.onCalendarDragComplete(),!1},destroy:function(){Ext.each(this.shims,function(n){n&&Ext.destroy(n)}),Ext.removeNode(this.shimCt),delete this.shimCt,this.shims.length=0}}),Ext.define("Extensible.calendar.dd.DayDragZone",{extend:"Extensible.calendar.dd.DragZone",ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(n){var t=n.getTarget(this.resizeSelector,2,!0),r,i;return t?(r=t.parent(this.eventSelector),i=this.view.getEventRecordFromEl(r),!i)?void 0:{type:"eventresize",xy:n.getXY(),ddel:r.dom,eventStart:i.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:i.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}:(t=n.getTarget(this.eventSelector,this.eventSelectorDepth),t)?(i=this.view.getEventRecordFromEl(t),!i)?void 0:{type:"eventdrag",xy:n.getXY(),ddel:t,eventStart:i.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:i.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}:(t=this.view.getDayAt(n.getX(),n.getY()),t.el)?{type:"caldrag",dayInfo:t,proxy:this.proxy}:null}}),Ext.define("Extensible.calendar.dd.DayDropZone",{extend:"Extensible.calendar.dd.DropZone",ddGroup:"DayViewDD",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",onNodeOver:function(n,t,i,r){var o,h=this.createText,e=Extensible.Date.use24HourTime?"G:i":"g:ia",v,u,s,f,c;if(r.type=="caldrag")this.dragStartMarker||(this.dragStartMarker=n.el.parent().createChild({style:"position:absolute;"}),this.dragStartMarker.setBox(r.dayInfo.timeBox),this.dragCreateDt=r.dayInfo.date),u=this.dragStartMarker.getBox(),u.height=Math.ceil(Math.abs(i.getY()-u.y)/n.timeBox.height)*n.timeBox.height,i.getY()<u.y?(u.height+=n.timeBox.height,u.y=u.y-u.height+n.timeBox.height,v=Extensible.Date.add(this.dragCreateDt,{minutes:this.ddIncrement})):n.date=Extensible.Date.add(n.date,{minutes:this.ddIncrement}),this.shim(this.dragCreateDt,u),s=Extensible.Date.diff(this.dragCreateDt,n.date),f=Extensible.Date.add(this.dragCreateDt,{millis:s}),this.dragStartDate=Extensible.Date.min(this.dragCreateDt,f),this.dragEndDate=v||Extensible.Date.max(this.dragCreateDt,f),o=Ext.String.format(this.dateRangeFormat,Ext.Date.format(this.dragStartDate,e),Ext.Date.format(this.dragEndDate,e));else{var y=Ext.get(r.ddel),p=y.parent().parent(),u=y.getBox();if(u.width=p.getWidth(),r.type=="eventdrag"&&(this.dragOffset===undefined?(c=this.view.getDayAt(r.xy[0],r.xy[1]).timeBox,this.dragOffset=c.y-u.y):u.y=n.timeBox.y,o=Ext.Date.format(n.date,this.dateFormat+" "+e),u.x=n.el.getLeft(),this.shim(n.date,u),h=i.ctrlKey||i.altKey?this.copyText:this.moveText),r.type=="eventresize"){this.resizeDt||(this.resizeDt=n.date),u.x=p.getLeft(),u.height=Math.ceil(Math.abs(i.getY()-u.y)/n.timeBox.height)*n.timeBox.height,i.getY()<u.y?u.y-=u.height:n.date=Extensible.Date.add(n.date,{minutes:this.ddIncrement}),this.shim(this.resizeDt,u);var s=Extensible.Date.diff(this.resizeDt,n.date),f=Extensible.Date.add(this.resizeDt,{millis:s}),l=Extensible.Date.min(r.eventStart,f),a=Extensible.Date.max(r.eventStart,f);r.resizeDates={StartDate:l,EndDate:a},o=Ext.String.format(this.dateRangeFormat,Ext.Date.format(l,e),Ext.Date.format(a,e)),h=this.resizeText}}return r.proxy.updateMsg(Ext.String.format(h,o)),this.dropAllowed},shim:function(n,t){Ext.each(this.shims,function(n){n&&(n.isActive=!1,n.hide())});var i=this.shims[0];i||(i=this.createShim(),this.shims[0]=i),i.isActive=!0,i.show(),i.setBox(t)},onNodeDrop:function(n,t,i,r){var u;if(n&&r){if(r.type=="eventdrag"){u=this.view.getEventRecordFromEl(r.ddel);this.view.onEventDrop(u,n.date,i.ctrlKey||i.altKey?"copy":"move");return this.onCalendarDragComplete(),delete this.dragOffset,!0}if(r.type=="eventresize"){u=this.view.getEventRecordFromEl(r.ddel);this.view.onEventResize(u,r.resizeDates);return this.onCalendarDragComplete(),delete this.resizeDt,!0}if(r.type=="caldrag"){Ext.destroy(this.dragStartMarker),delete this.dragStartMarker,delete this.dragCreateDt;this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this));return!0}}return this.onCalendarDragComplete(),!1}}),Ext.define("Extensible.calendar.data.EventModel",{extend:"Extensible.data.Model",requires:["Extensible.calendar.data.EventMappings"],mappingClass:"Extensible.calendar.data.EventMappings",mappingIdProperty:"EventId",inheritableStatics:{resolution:"minutes"},isRecurring:function(){var t=Extensible.calendar.data.EventMappings.RRule,n;return t?(n=this.get(t.name),n!==undefined&&n!==""):!1},getStartDate:function(){return this.get(Extensible.calendar.data.EventMappings.StartDate.name)},getEndDate:function(){var i=Extensible.calendar.data.EventMappings,t=i.Duration?this.get(i.Duration.name):null,n;return t!==null&&t>-1?(n={},n[Extensible.calendar.data.EventModel.resolution]=t,Extensible.Date.add(this.getStartDate(),n)):this.get(i.EndDate.name)},clearRecurrence:function(){var n=this,t=Extensible.calendar.data.EventMappings;return delete n.data[t.OriginalEventId.name],delete n.data[t.RRule.name],delete n.data[t.RInstanceStartDate.name],delete n.data[t.REditMode.name],n}},function(){this.reconfigure()}),Ext.define("Extensible.calendar.data.EventStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.EventModel",constructor:function(n){n=n||{},this.deferLoad=n.autoLoad,n.autoLoad=!1,this.callParent(arguments)},load:function(n){Extensible.log("store load"),n=n||{},n.params&&delete this.initialParams,this.initialParams&&(n.params=n.params||{},Ext.apply(n.params,this.initialParams),delete this.initialParams),this.callParent(arguments)}}),Ext.define("Extensible.calendar.data.CalendarModel",{extend:"Extensible.data.Model",requires:["Extensible.calendar.data.CalendarMappings"],mappingClass:"Extensible.calendar.data.CalendarMappings",mappingIdProperty:"CalendarId"},function(){this.reconfigure()}),Ext.define("Extensible.calendar.data.MemoryCalendarStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.CalendarModel",requires:["Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Extensible.calendar.data.CalendarModel","Extensible.calendar.data.CalendarMappings"],proxy:{type:"memory",reader:{type:"json",root:"calendars"},writer:{type:"json"}},autoLoad:!0,initComponent:function(){this.sorters=this.sorters||[{property:Extensible.calendar.data.CalendarMappings.Title.name,direction:"ASC"}],this.idProperty=this.idProperty||Extensible.calendar.data.CalendarMappings.CalendarId.name||"id",this.fields=Extensible.calendar.data.CalendarModel.prototype.fields.getRange(),this.callParent(arguments)}}),Ext.define("Extensible.calendar.data.MemoryEventStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.EventModel",requires:["Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Extensible.calendar.data.EventModel","Extensible.calendar.data.EventMappings"],proxy:{type:"memory",reader:{type:"json",root:"evts"},writer:{type:"json"}},idSeed:2e3,constructor:function(n){if(n=n||{},this.callParent(arguments),this.sorters=this.sorters||[{property:Extensible.calendar.data.EventMappings.StartDate.name,direction:"ASC"}],this.idProperty=this.idProperty||Extensible.calendar.data.EventMappings.EventId.mapping||"id",this.fields=Extensible.calendar.data.EventModel.prototype.fields.getRange(),n.autoMsg!==!1)this.on("write",this.onWrite,this);this.autoMsg=n.autoMsg,this.onCreateRecords=Ext.Function.createInterceptor(this.onCreateRecords,this.interceptCreateRecords),this.initRecs()},interceptCreateRecords:function(n,t,i){if(i)for(var r=0,f,u=n.length;r<u;r++)n[r].data[Extensible.calendar.data.EventMappings.EventId.name]=this.idSeed++},initRecs:function(){this.each(function(n){n.store=this,n.phantom=!1},this)},onWrite:function(n,t){var u=this;if(Extensible.example&&Extensible.example.msg){var f=t.wasSuccessful(),r=t.records[0],i=r.data[Extensible.calendar.data.EventMappings.Title.name];switch(t.action){case"create":Extensible.example.msg("Add",'Added "'+Ext.value(i,"(No title)")+'"');break;case"update":Extensible.example.msg("Update",'Updated "'+Ext.value(i,"(No title)")+'"');break;case"destroy":Extensible.example.msg("Delete",'Deleted "'+Ext.value(i,"(No title)")+'"')}}},onProxyLoad:function(n){var t=this,u=n.wasSuccessful(),r=n.getResultSet(),i=[];t.data&&t.data.length>0?(t.totalCount=t.data.length,i=t.data.items):(r&&(i=r.records,t.totalCount=r.total),u&&t.loadRecords(i,n)),t.loading=!1,t.fireEvent("load",t,i,u)}}),Ext.define("Extensible.calendar.util.WeekEventRenderer",{requires:["Ext.core.DomHelper"],statics:{getEventRow:function(n,t,i){var e=1,f=Ext.get(n+"-wk-"+t),r,u;return f&&(u=f.child(".ext-cal-evt-tbl",!0),r=u.tBodies[0].childNodes[i+e],r||(r=Ext.core.DomHelper.append(u.tBodies[0],"<tr></tr>"))),Ext.get(r)},renderEvent:function(n,t,i,r,u,f,e){var l=Extensible.calendar.data.EventMappings,o=n.data||n.event.data,a=Ext.Date.clone(f),y=Extensible.Date.add(a,{days:u-i,millis:-1}),v=this.getEventRow(e.viewId,t,r),h=(n.event||n).getEndDate(),p=Extensible.Date.diffDays(f,h)+1,c=Math.min(p,u-i),s;o._weekIndex=t,o._renderAsAllDay=o[l.IsAllDay.name]||n.isSpanStart,o.spanLeft=o[l.StartDate.name].getTime()<a.getTime(),o.spanRight=h.getTime()>y.getTime(),o.spanCls=o.spanLeft?o.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":o.spanRight?"ext-cal-ev-spanright":"",s={tag:"td",cls:"ext-cal-ev",cn:e.tpl.apply(e.templateDataFn(o))},c>1&&(s.colspan=c),Ext.core.DomHelper.append(v,s)},render:function(n){for(var s=this,p="&#160;",t=0,d=n.eventGrid,h=Ext.Date.clone(n.viewStart),a="",g=n.tpl,y=n.maxEventsPerDay!=undefined?n.maxEventsPerDay:999,k=n.weekCount<1?6:n.weekCount,b=n.weekCount==1?n.dayCount:7,i,f,c,r,o,v,u,l,e,nt,w;t<k;t++)for(f=0,c=d[t];f<b;f++){if(a=Ext.Date.format(h,"Ymd"),c&&c[f]){for(r=0,o=0,v=c[f],u=v.length;r<u;r++)if(v[r]){if(r>=y){o++;continue}l=v[r],(!l.isSpan||l.isSpanStart)&&s.renderEvent(l,t,f,r,b,h,n)}else{if(r>=y)continue;i=s.getEventRow(n.viewId,t,r),Ext.core.DomHelper.append(i,{tag:"td",cls:"ext-cal-ev",html:p,id:n.viewId+"-empty-"+u+"-day-"+a})}o>0?(i=s.getEventRow(n.viewId,t,y),Ext.core.DomHelper.append(i,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+Ext.Date.format(h,"Ymd"),cn:{tag:"a",html:Ext.String.format(n.getMoreText(o),o)}})):u<n.evtMaxCount[t]&&(i=s.getEventRow(n.viewId,t,u),i&&(e={tag:"td",cls:"ext-cal-ev",html:p,id:n.viewId+"-empty-"+(u+1)+"-day-"+a},w=n.evtMaxCount[t]-u,w>1&&(e.rowspan=w),Ext.core.DomHelper.append(i,e)))}else i=s.getEventRow(n.viewId,t,0),i&&(e={tag:"td",cls:"ext-cal-ev",html:p,id:n.viewId+"-empty-day-"+a},n.evtMaxCount[t]>1&&(e.rowspan=n.evtMaxCount[t]),Ext.core.DomHelper.append(i,e));h=Extensible.Date.add(h,{days:1})}}}}),Ext.define("Extensible.calendar.form.field.CalendarCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.extensible.calendarcombo",requires:["Extensible.calendar.data.CalendarMappings"],fieldLabel:"Calendar",triggerAction:"all",queryMode:"local",forceSelection:!0,selectOnFocus:!0,defaultCls:"x-cal-default",hiddenCalendarCls:"ext-cal-hidden",initComponent:function(){this.valueField=Extensible.calendar.data.CalendarMappings.CalendarId.name,this.displayField=Extensible.calendar.data.CalendarMappings.Title.name,this.listConfig=Ext.apply(this.listConfig||{},{getInnerTpl:this.getListItemTpl});this.store.on("update",this.refreshColorCls,this);this.callParent(arguments)},getListItemTpl:function(n){return'<div class="x-combo-list-item x-cal-{'+Extensible.calendar.data.CalendarMappings.ColorId.name+'}"><div class="ext-cal-picker-icon">&#160;</div>{'+n+"}</div>"},afterRender:function(){this.callParent(arguments),this.wrap=this.el.down(".x-form-item-body"),this.wrap.addCls("ext-calendar-picker"),this.icon=Ext.core.DomHelper.append(this.wrap,{tag:"div",cls:"ext-cal-picker-icon ext-cal-picker-mainicon"})},refreshColorCls:function(){var t=this,r=Extensible.calendar.data.CalendarMappings,i="",n=t.getValue();return t.wrap?(t.currentStyleClss!==undefined&&t.wrap.removeCls(t.currentStyleClss),Ext.isEmpty(n)||(Ext.isArray(n)&&(n=n[0]),n.data||(n=this.store.findRecord(r.CalendarId.name,n)),i="x-cal-"+(n.data?n.data[r.ColorId.name]:n)),t.currentStyleClss=i,t.wrap.addCls(i),t):t},setValue:function(n){!n&&this.store.getCount()>0&&(n=this.store.getAt(0).data[Extensible.calendar.data.CalendarMappings.CalendarId.name]),this.callParent(arguments),this.refreshColorCls()}}),Ext.define("Extensible.form.field.DateRangeLayout",{extend:"Ext.layout.container.Container",alias:["layout.extensible.daterange"],onLayout:function(){var i=this,t=i.getShadowCt(),n=i.owner,r=n.isSingleLine();i.owner.suspendLayout=!0,r?t.getComponent("row1").add(n.startDate,n.startTime,n.toLabel,n.endTime,n.endDate,n.allDay):(t.getComponent("row1").add(n.startDate,n.startTime,n.toLabel),t.getComponent("row2").add(n.endDate,n.endTime,n.allDay)),t.rendered||t.render(i.getRenderTarget()),t.doComponentLayout(),n.setHeight(t.getHeight()-5),delete i.owner.suspendLayout},getShadowCt:function(){var n=this,t=[];return n.shadowCt||(n.shadowCt=Ext.createWidget("container",{layout:"auto",anchor:"100%",ownerCt:n.owner,items:[{xtype:"container",itemId:"row1",layout:"hbox",defaults:{margins:"0 5 0 0"}},{xtype:"container",itemId:"row2",layout:"hbox",defaults:{margins:"0 5 0 0"}}]})),n.shadowCt},renderItems:Ext.emptyFn}),Ext.define("Extensible.form.field.DateRange",{extend:"Ext.form.FieldContainer",alias:"widget.extensible.daterangefield",requires:["Ext.form.field.Date","Ext.form.field.Time","Ext.form.Label","Ext.form.field.Checkbox"],toText:"to",allDayText:"All day",singleLine:!0,dateFormat:"n/j/Y",fieldLayout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}},initComponent:function(){var n=this;n.timeFormat=n.timeFormat||(Extensible.Date.use24HourTime?"G:i":"g:i A"),n.addCls("ext-dt-range"),n.singleLine?(n.layout=n.fieldLayout,n.items=n.getFieldConfigs()):n.items=[{xtype:"container",layout:n.fieldLayout,items:[n.getStartDateConfig(),n.getStartTimeConfig(),n.getDateSeparatorConfig()]},{xtype:"container",layout:n.fieldLayout,items:[n.getEndDateConfig(),n.getEndTimeConfig(),n.getAllDayConfig()]}],n.callParent(arguments),n.initRefs()},initRefs:function(){var n=this;n.startDate=n.down("#"+n.id+"-start-date"),n.startTime=n.down("#"+n.id+"-start-time"),n.endTime=n.down("#"+n.id+"-end-time"),n.endDate=n.down("#"+n.id+"-end-date"),n.allDay=n.down("#"+n.id+"-allday"),n.toLabel=n.down("#"+n.id+"-to-label")},getFieldConfigs:function(){var n=this;return[n.getStartDateConfig(),n.getStartTimeConfig(),n.getDateSeparatorConfig(),n.getEndTimeConfig(),n.getEndDateConfig(),n.getAllDayConfig()]},getLayoutItems:function(n){var t=this;return n?t.items.items:[[t.startDate,t.startTime,t.toLabel],[t.endDate,t.endTime,t.allDay]]},getStartDateConfig:function(){return{xtype:"datefield",id:this.id+"-start-date",format:this.dateFormat,width:100,listeners:{change:{fn:function(){this.onFieldChange("date","start")},scope:this}}}},getStartTimeConfig:function(){return{xtype:"timefield",id:this.id+"-start-time",hidden:this.showTimes===!1,labelWidth:0,hideLabel:!0,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","start")},scope:this}}}},getEndDateConfig:function(){return{xtype:"datefield",id:this.id+"-end-date",format:this.dateFormat,hideLabel:!0,width:100,listeners:{change:{fn:function(){this.onFieldChange("date","end")},scope:this}}}},getEndTimeConfig:function(){return{xtype:"timefield",id:this.id+"-end-time",hidden:this.showTimes===!1,labelWidth:0,hideLabel:!0,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","end")},scope:this}}}},getAllDayConfig:function(){return{xtype:"checkbox",id:this.id+"-allday",hidden:this.showTimes===!1||this.showAllDay===!1,boxLabel:this.allDayText,margins:{top:2,right:5,bottom:0,left:0},handler:this.onAllDayChange,scope:this}},onAllDayChange:function(n,t){this.startTime.setVisible(!t),this.endTime.setVisible(!t)},getDateSeparatorConfig:function(){return{xtype:"label",id:this.id+"-to-label",text:this.toText,margins:{top:4,right:5,bottom:0,left:0}}},isSingleLine:function(){var n=this;if(n.calculatedSingleLine===undefined)if(n.singleLine=="auto"){var i=n.ownerCt.getEl(),r=n.ownerCt.getWidth()-i.getPadding("lr"),t=i.down(".x-panel-body");t&&(r-=t.getPadding("lr")),t=i.down(".x-form-item-label"),t&&(r-=t.getWidth()-t.getPadding("lr")),singleLine=r<=n.singleLineMinWidth?!1:!0}else n.calculatedSingleLine=n.singleLine!==undefined?n.singleLine:!0;return n.calculatedSingleLine},onFieldChange:function(n,t){this.checkDates(n,t),this.fireEvent("change",this,this.getValue())},checkDates:function(n,t){var i=this,f=n==="date"?"Date":"Time",o=this["start"+f],e=this["end"+f],r=i.getDT("start"),u=i.getDT("end");r>u&&(t=="start"?e.setValue(r):(o.setValue(u),i.checkDates(n,"start"))),n=="date"&&i.checkDates("time",t)},getValue:function(){return[this.getDT("start"),this.getDT("end"),this.allDay.getValue()]},getDT:function(n){var i=this[n+"Time"].getValue(),t=this[n+"Date"].getValue(),r;if(Ext.isDate(t))t=Ext.Date.format(t,this[n+"Date"].format);else return null;return i&&i!=""?(i=Ext.Date.format(i,this[n+"Time"].format),r=Ext.Date.parseDate(t+" "+i,this[n+"Date"].format+" "+this[n+"Time"].format)):Ext.Date.parseDate(t,this[n+"Date"].format)},setValue:function(n){if(n){var t=this,r=Extensible.calendar.data.EventMappings,i=r.StartDate.name;Ext.isArray(n)?(t.setDT(n[0],"start"),t.setDT(n[1],"end"),t.allDay.setValue(!!n[2])):Ext.isDate(n)?(t.setDT(n,"start"),t.setDT(n,"end"),t.allDay.setValue(!1)):n[i]&&(t.setDT(n[i],"start"),t.setDT(n[r.EndDate.name],"end")||t.setDT(n[i],"end"),t.allDay.setValue(!!n[r.IsAllDay.name]))}},setDT:function(n,t){if(n&&Ext.isDate(n))return this[t+"Date"].setValue(n),this[t+"Time"].setValue(Ext.Date.format(n,this[t+"Time"].format)),!0},isDirty:function(){var n=!1;return this.rendered&&!this.disabled&&this.items.each(function(t){if(t.isDirty())return n=!0,!1}),n},reset:function(){this.delegateFn("reset")},delegateFn:function(n){this.items.each(function(t){t[n]&&t[n]()})},beforeDestroy:function(){Ext.destroy(this.fieldCt),this.callParent(arguments)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn}),Ext.define("Extensible.calendar.form.field.ReminderCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.extensible.remindercombo",requires:["Ext.data.ArrayStore"],fieldLabel:"Reminder",queryMode:"local",triggerAction:"all",forceSelection:!0,displayField:"desc",valueField:"value",noneText:"None",atStartTimeText:"At start time",reminderValueFormat:"{0} {1} before start",minutesText:"minutes",hourText:"hour",hoursText:"hours",dayText:"day",daysText:"days",weekText:"week",weeksText:"weeks",initComponent:function(){this.store=this.store||Ext.create("Ext.data.ArrayStore",{fields:["value","desc"],idIndex:0,data:this.getValueList()}),this.callParent(arguments)},getValueList:function(){var n=this,i=n.reminderValueFormat,t=Ext.String.format;return[["",n.noneText],["0",n.atStartTimeText],["5",t(i,"5",n.getMinutesText(5))],["15",t(i,"15",n.getMinutesText(15))],["30",t(i,"30",n.getMinutesText(30))],["60",t(i,"1",n.getHoursText(1))],["90",t(i,"1.5",n.getHoursText(1.5))],["120",t(i,"2",n.getHoursText(2))],["180",t(i,"3",n.getHoursText(3))],["360",t(i,"6",n.getHoursText(6))],["720",t(i,"12",n.getHoursText(12))],["1440",t(i,"1",n.getDaysText(1))],["2880",t(i,"2",n.getDaysText(2))],["4320",t(i,"3",n.getDaysText(3))],["5760",t(i,"4",n.getDaysText(4))],["7200",t(i,"5",n.getDaysText(5))],["10080",t(i,"1",n.getWeeksText(1))],["20160",t(i,"2",n.getWeeksText(2))]]},getMinutesText:function(n){return n===1?this.minuteText:this.minutesText},getHoursText:function(n){return n===1?this.hourText:this.hoursText},getDaysText:function(n){return n===1?this.dayText:this.daysText},getWeeksText:function(n){return n===1?this.weekText:this.weeksText},initValue:function(){this.value!==undefined?this.setValue(this.value):this.setValue(""),this.originalValue=this.getValue()}}),Ext.define("Extensible.calendar.util.ColorPicker",{extend:"Ext.picker.Color",alias:"widget.extensible.calendarcolorpicker",requires:["Ext.XTemplate"],colorCount:32,constructor:function(){this.renderTpl=Ext.create("Ext.XTemplate",'<tpl for="colors"><a href="#" class="x-cal-{.}" hidefocus="on"><em><span unselectable="on">&#160;</span></em></a></tpl>'),this.callParent(arguments)},initComponent:function(){if(this.callParent(arguments),this.addCls("x-calendar-palette"),this.handler)this.on("select",this.handler,this.scope||this,{delegate:"a"});this.colors=[];for(var n=1;n<=this.colorCount;n++)this.colors.push(n)},handleClick:function(n,t){n.preventDefault();var i=t.className.split("x-cal-")[1];this.select(i)},select:function(n,t){var i=this,u=i.selectedCls,f=i.value,r;if(!i.rendered){i.value=n;return}(n!=f||i.allowReselect)&&(r=i.el,i.value&&r.down(".x-cal-"+f).removeCls(u),r.down(".x-cal-"+n).addCls(u),i.value=n,t!==!0&&i.fireEvent("select",i,n))}}),Ext.define("Extensible.calendar.gadget.CalendarListMenu",{extend:"Ext.menu.Menu",alias:"widget.extensible.calendarlistmenu",requires:["Extensible.calendar.util.ColorPicker"],hideOnClick:!0,ignoreParentClicks:!0,displayOnlyThisCalendarText:"Display only this calendar",enableScrolling:!1,initComponent:function(){this.addEvents("showcalendar","hidecalendar","radiocalendar","colorchange"),Ext.apply(this,{items:[{text:this.displayOnlyThisCalendarText,iconCls:"extensible-cal-icon-cal-show",handler:Ext.bind(this.handleRadioCalendarClick,this)},"-",{xtype:"extensible.calendarcolorpicker",id:this.id+"-calendar-color-picker",handler:Ext.bind(this.handleColorSelect,this)}]}),this.addClass("x-calendar-list-menu"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.palette=this.down("#"+this.id+"-calendar-color-picker"),this.colorId&&this.palette.select(this.colorId,!0)},handleRadioCalendarClick:function(){this.fireEvent("radiocalendar",this,this.calendarId)},handleColorSelect:function(n,t){this.fireEvent("colorchange",this,this.calendarId,t,this.colorId),this.colorId=t,this.menuHide()},setCalendar:function(n,t){return this.calendarId=n,this.colorId=t,this.rendered&&this.palette.select(t,!0),this},menuHide:function(){this.hideOnClick&&this.hide()}}),Ext.define("Extensible.calendar.gadget.CalendarListPanel",{extend:"Ext.panel.Panel",alias:"widget.extensible.calendarlist",requires:["Ext.XTemplate","Extensible.calendar.gadget.CalendarListMenu"],title:"Calendars",collapsible:!0,autoHeight:!0,layout:"fit",menuSelector:"em",width:100,initComponent:function(){this.addCls("x-calendar-list"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.store&&this.setStore(this.store,!0),this.refresh();this.body.on("click",this.onClick,this);this.body.on("mouseover",this.onMouseOver,this,{delegate:"li"});this.body.on("mouseout",this.onMouseOut,this,{delegate:"li"})},getListTemplate:function(){return this.tpl||(this.tpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evo {colorCls} {hiddenCls}">','<div class="ext-cal-evm">','<div class="ext-cal-evi">{title}<em>&#160;</em></div>',"</div>","</li>","</tpl></ul>"):Ext.create("Ext.XTemplate",'<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evr {colorCls} {hiddenCls}">{title}<em>&#160;</em></li>',"</tpl></ul>"),this.tpl.compile()),this.tpl},setStore:function(n,t){if(!t&&this.store&&(this.store.un("load",this.refresh,this),this.store.un("add",this.refresh,this),this.store.un("remove",this.refresh,this),this.store.un("update",this.onUpdate,this),this.store.un("clear",this.refresh,this)),n){n.on("load",this.refresh,this);n.on("add",this.refresh,this);n.on("remove",this.refresh,this);n.on("update",this.onUpdate,this);n.on("clear",this.refresh,this)}this.store=n},onUpdate:function(n,t,i){i==Ext.data.Record.COMMIT&&this.refresh()},refresh:function(){if(!this.skipRefresh){for(var r=[],n=0,u=null,i=Extensible.calendar.data.CalendarMappings,t=this.store.getRange(),f=t.length;n<f;n++)u={cmpId:this.id+"__"+t[n].data[i.CalendarId.name],title:t[n].data[i.Title.name],colorCls:this.getColorCls(t[n].data[i.ColorId.name])},t[n].data[i.IsHidden.name]===!0&&(u.hiddenCls="ext-cal-hidden"),r[r.length]=u;this.getListTemplate().overwrite(this.body,r)}},getColorCls:function(n){return"x-cal-"+n+"-ad"},toggleCalendar:function(n,t){var i=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,n);CM=Extensible.calendar.data.CalendarMappings,isHidden=i.data[CM.IsHidden.name],i.set(CM.IsHidden.name,!isHidden),t!==!1&&i.commit()},showCalendar:function(n,t){var i=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,n);i.data[Extensible.calendar.data.CalendarMappings.IsHidden.name]===!0&&this.toggleCalendar(n,t)},hideCalendar:function(n,t){var i=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,n);i.data[Extensible.calendar.data.CalendarMappings.IsHidden.name]!==!0&&this.toggleCalendar(n,t)},radioCalendar:function(n){for(var i=0,t,f=Extensible.calendar.data.CalendarMappings.CalendarId.name,r=this.store.getRange(),u=r.length;i<u;i++)t=r[i].data[f],t==n?this.showCalendar(t,!1):this.hideCalendar(t,!1);this.skipRefresh=!0,this.store.sync(),delete this.skipRefresh,this.refresh()},onMouseOver:function(n,t){Ext.fly(t).addCls("hover")},onMouseOut:function(n,t){Ext.fly(t).removeCls("hover")},getCalendarId:function(n){return n.id.split("__")[1]},getCalendarItemEl:function(n){return Ext.get(this.id+"__"+n)},onClick:function(n){var i;(i=n.getTarget(this.menuSelector,3,!0))?this.showEventMenu(i,n.getXY()):(i=n.getTarget("li",3,!0))&&this.toggleCalendar(this.getCalendarId(i))},handleColorChange:function(n,t,i){var u=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,t);u.data[Extensible.calendar.data.CalendarMappings.ColorId.name]=i,u.commit()},handleRadioCalendar:function(n,t){this.radioCalendar(t)},showEventMenu:function(n,t){var i=this.getCalendarId(n.parent("li")),r=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,i);if(colorId=r.data[Extensible.calendar.data.CalendarMappings.ColorId.name],!this.menu){this.menu=Ext.create("Extensible.calendar.gadget.CalendarListMenu");this.menu.on("colorchange",this.handleColorChange,this);this.menu.on("radiocalendar",this.handleRadioCalendar,this)}this.menu.setCalendar(i,colorId),this.menu.showAt(t)}}),Ext.define("Extensible.calendar.menu.Event",{extend:"Ext.menu.Menu",alias:"widget.extensible.eventcontextmenu",requires:["Ext.menu.DatePicker"],hideOnClick:!0,ignoreParentClicks:!0,editDetailsText:"Edit Details",deleteText:"Delete",moveToText:"Move to...",copyToText:"Copy to...",enableScrolling:!1,initComponent:function(){this.addEvents("editdetails","eventdelete","eventmove","eventcopy"),this.buildMenu(),this.callParent(arguments)},buildMenu:function(){var n=this;n.rendered||(n.dateMenu=Ext.create("Ext.menu.DatePicker",{scope:n,handler:n.onEventMoveSelected}),n.copyMenu=Ext.create("Ext.menu.DatePicker",{scope:n,handler:n.onEventCopySelected}),Ext.apply(n,{items:[{text:n.editDetailsText,iconCls:"extensible-cal-icon-evt-edit",scope:n,handler:function(){n.fireEvent("editdetails",n,n.rec,n.ctxEl)}},{text:n.deleteText,iconCls:"extensible-cal-icon-evt-del",scope:n,handler:function(){n.fireEvent("eventdelete",n,n.rec,n.ctxEl)}},"-",{text:n.moveToText,iconCls:"extensible-cal-icon-evt-move",menu:n.dateMenu},{text:n.copyToText,iconCls:"extensible-cal-icon-evt-copy",menu:n.copyMenu}]}))},onEventMoveSelected:function(n,t){this.doCopyOrMove(t,"move")},onEventCopySelected:function(n,t){this.doCopyOrMove(t,"copy")},doCopyOrMove:function(n,t){n=Extensible.Date.copyTime(this.rec.data[Extensible.calendar.data.EventMappings.StartDate.name],n),this.fireEvent("event"+t,this,this.rec,n)},showForEvent:function(n,t,i){var r=this,u=n.data[Extensible.calendar.data.EventMappings.StartDate.name];r.rec=n,r.ctxEl=t,r.dateMenu.picker.setValue(u),r.copyMenu.picker.setValue(u),r.showAt(i)},onHide:function(){this.callParent(arguments),delete this.ctxEl}}),Ext.define("Extensible.calendar.form.EventDetails",{extend:"Ext.form.Panel",alias:"widget.extensible.eventeditform",requires:["Extensible.form.field.DateRange","Extensible.calendar.form.field.ReminderCombo","Extensible.calendar.data.EventMappings","Extensible.calendar.form.field.CalendarCombo","Extensible.form.recurrence.Fieldset","Ext.layout.container.Column","Extensible.form.recurrence.RangeEditWindow"],labelWidth:65,labelWidthRightCol:65,colWidthLeft:".9",colWidthRight:".1",title:"Event Form",titleTextAdd:"Add Event",titleTextEdit:"Edit Event",titleLabelText:"Title",datesLabelText:"When",reminderLabelText:"Reminder",notesLabelText:"Notes",locationLabelText:"Location",webLinkLabelText:"Web Link",calendarLabelText:"Calendar",repeatsLabelText:"Repeats",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",bodyStyle:"padding:20px 20px 10px;",border:!1,buttonAlign:"center",autoScroll:!0,recurrence:!1,allowDefaultAdd:!0,layout:"column",initComponent:function(){var i,n,t;this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0}),this.titleField=Ext.create("Ext.form.TextField",{fieldLabel:this.titleLabelText,name:Extensible.calendar.data.EventMappings.Title.name,anchor:"70%"}),this.dateRangeField=Ext.create("Extensible.form.field.DateRange",{fieldLabel:this.datesLabelText,singleLine:!1,anchor:"70%",listeners:{change:Ext.bind(this.onDateChange,this)}}),this.reminderField=Ext.create("Extensible.calendar.form.field.ReminderCombo",{name:Extensible.calendar.data.EventMappings.Reminder.name,fieldLabel:this.reminderLabelText,anchor:"70%"}),this.notesField=Ext.create("Ext.form.TextArea",{fieldLabel:this.notesLabelText,name:Extensible.calendar.data.EventMappings.Notes.name,grow:!0,growMax:150,anchor:"70%"}),this.locationField=Ext.create("Ext.form.TextField",{fieldLabel:this.locationLabelText,name:Extensible.calendar.data.EventMappings.Location.name,anchor:"70%"}),this.urlField=Ext.create("Ext.form.TextField",{fieldLabel:this.webLinkLabelText,name:Extensible.calendar.data.EventMappings.Url.name,anchor:"70%"}),i=[],n=[this.titleField,this.dateRangeField,this.reminderField,this.notesField,this.locationField,this.urlField],this.recurrence&&(this.recurrenceField=Ext.create("Extensible.form.recurrence.Fieldset",{recurrenceOptions:this.recurrence,name:Extensible.calendar.data.EventMappings.RRule.name,fieldLabel:this.repeatsLabelText,anchor:"70%"}),n.splice(2,0,this.recurrenceField)),this.calendarStore&&(this.calendarField=Ext.create("Extensible.calendar.form.field.CalendarCombo",{store:this.calendarStore,fieldLabel:this.calendarLabelText,name:Extensible.calendar.data.EventMappings.CalendarId.name,anchor:"70%"}),n.splice(2,0,this.calendarField)),t=Math.max(this.labelWidthRightCol,this.labelWidth),this.items=[{id:this.id+"-left-col",columnWidth:this.colWidthLeft,layout:"anchor",fieldDefaults:{labelWidth:t},border:!1,items:n},{id:this.id+"-right-col",columnWidth:this.colWidthRight,layout:"anchor",fieldDefaults:{labelWidth:t},border:!1,items:i}],this.fbar=[{text:this.saveButtonText,scope:this,handler:this.onSave},{itemId:this.id+"-del-btn",text:this.deleteButtonText,scope:this,handler:this.onDelete},{text:this.cancelButtonText,scope:this,handler:this.onCancel}],this.addCls("ext-evt-edit-form"),Ext.apply(this.initialConfig,{trackResetOnLoad:!0}),this.callParent(arguments)},onDateChange:function(n,t){this.recurrenceField&&this.recurrenceField.setStartDate(t[0])},loadRecord:function(n){var t=this,i=Extensible.calendar.data.EventMappings;t.form.reset().loadRecord.apply(t.form,arguments),t.activeRecord=n,t.dateRangeField.setValue(n.data),t.recurrenceField&&(t.recurrenceField.setStartDate(n.data[i.StartDate.name]),t.recurrenceField.setValue(n.data[i.RRule.name]),n.data[i.RInstanceStartDate.name]||(n.data[i.RInstanceStartDate.name]=n.getStartDate())),t.calendarField&&t.calendarField.setValue(n.data[i.CalendarId.name]),n.phantom?(t.setTitle(t.titleTextAdd),t.down("#"+t.id+"-del-btn").hide()):(t.setTitle(t.titleTextEdit),t.down("#"+t.id+"-del-btn").show()),t.form.getFields().each(function(n){n.resetOriginalValue()}),t.titleField.focus()},updateRecord:function(n){var c=n.fields,h=this.getForm().getValues(),i=Extensible.calendar.data.EventMappings,u,t={};c.each(function(n){u=n.name,u in h&&(t[u]=h[u])});var r=this.dateRangeField.getValue(),f=t[i.IsAllDay.name]=r[2],s=f?Extensible.Date.clearTime(r[0]):r[0],o=f?Extensible.Date.clearTime(r[1]):r[1],e={days:1};return e[Extensible.calendar.data.EventModel.resolution]=-1,t[i.StartDate.name]=s,t[i.EndDate.name]=f?Extensible.Date.add(o,e):o,i.Duration&&(t[i.Duration.name]=Extensible.Date.diff(s,t[i.EndDate.name],Extensible.calendar.data.EventModel.resolution)),n.set(t),n.dirty||n.phantom&&this.allowDefaultAdd},onCancel:function(){this.cleanup(!0),this.fireEvent("eventcancel",this,this.activeRecord)},cleanup:function(){this.activeRecord&&this.activeRecord.reject(),delete this.activeRecord,this.form.isDirty()&&this.form.reset()},onSave:function(){var n=this,t=n.activeRecord.isRecurring();if(n.form.isValid()||n.allowDefaultAdd){if(!n.updateRecord(n.activeRecord)){n.onCancel();return}n.activeRecord.phantom?n.fireEvent("eventadd",n,n.activeRecord):t?n.onRecurrenceUpdate():n.fireEvent("eventupdate",n,n.activeRecord)}},onRecurrenceUpdate:function(){Extensible.form.recurrence.RangeEditWindow.prompt({callback:this.onRecurrenceEditModeSelected,scope:this})},onRecurrenceEditModeSelected:function(n){var t=this;n&&(t.activeRecord.data[Extensible.calendar.data.EventMappings.REditMode.name]=n,t.fireEvent("eventupdate",t,t.activeRecord,t.animateTarget))},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}}),Ext.define("Extensible.calendar.form.EventWindow",{extend:"Ext.window.Window",alias:"widget.extensible.eventeditwindow",requires:["Ext.form.Panel","Extensible.calendar.data.EventModel","Extensible.calendar.data.EventMappings","Extensible.form.recurrence.RangeEditWindow"],titleTextAdd:"Add Event",titleTextEdit:"Edit Event",width:600,labelWidth:65,detailsLinkText:"Edit Details...",savingMessage:"Saving changes...",deletingMessage:"Deleting event...",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",titleLabelText:"Title",datesLabelText:"When",calendarLabelText:"Calendar",closeAction:"hide",modal:!1,resizable:!1,constrain:!0,buttonAlign:"left",editDetailsLinkClass:"edit-dtl-link",enableEditDetails:!0,layout:"fit",formPanelConfig:{border:!1},allowDefaultAdd:!0,initComponent:function(){this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0,editdetails:!0}),this.fbar=this.getFooterBarConfig(),this.callParent(arguments)},getFooterBarConfig:function(){var n=["->",{text:this.saveButtonText,itemId:this.id+"-save-btn",disabled:!1,handler:this.onSave,scope:this},{text:this.deleteButtonText,itemId:this.id+"-delete-btn",disabled:!1,handler:this.onDelete,scope:this,hideMode:"offsets"},{text:this.cancelButtonText,itemId:this.id+"-cancel-btn",disabled:!1,handler:this.onCancel,scope:this}];return this.enableEditDetails!==!1&&n.unshift({xtype:"tbtext",itemId:this.id+"-details-btn",text:'<a href="#" class="'+this.editDetailsLinkClass+'">'+this.detailsLinkText+"</a>"}),n},onRender:function(){this.formPanel=Ext.create("Ext.FormPanel",Ext.applyIf({fieldDefaults:{labelWidth:this.labelWidth},items:this.getFormItemConfigs()},this.formPanelConfig)),this.add(this.formPanel),this.callParent(arguments)},getFormItemConfigs:function(){var n=[{xtype:"textfield",itemId:this.id+"-title",name:Extensible.calendar.data.EventMappings.Title.name,fieldLabel:this.titleLabelText,anchor:"100%"},{xtype:"extensible.daterangefield",itemId:this.id+"-dates",name:"dates",anchor:"95%",singleLine:!0,fieldLabel:this.datesLabelText}];return this.calendarStore&&n.push({xtype:"extensible.calendarcombo",itemId:this.id+"-calendar",name:Extensible.calendar.data.EventMappings.CalendarId.name,anchor:"100%",fieldLabel:this.calendarLabelText,store:this.calendarStore}),n},afterRender:function(){this.callParent(arguments),this.el.addCls("ext-cal-event-win"),this.initRefs();var n=this.getDockedItems("toolbar")[0].items.items[0];n.el.hasCls("x-component-default")&&Ext.destroy(n)},initRefs:function(){if(this.saveButton=this.down("#"+this.id+"-save-btn"),this.deleteButton=this.down("#"+this.id+"-delete-btn"),this.cancelButton=this.down("#"+this.id+"-cancel-btn"),this.detailsButton=this.down("#"+this.id+"-details-btn"),this.detailsButton)this.detailsButton.getEl().on("click",this.onEditDetailsClick,this);this.titleField=this.down("#"+this.id+"-title"),this.dateRangeField=this.down("#"+this.id+"-dates"),this.calendarField=this.down("#"+this.id+"-calendar")},onEditDetailsClick:function(n){n.stopEvent(),this.updateRecord(this.activeRecord,!0),this.fireEvent("editdetails",this,this.activeRecord,this.animateTarget)},show:function(n,t){var i=this,u=Extensible.calendar.data.EventMappings,e,r,f,o;return i.animateTarget=Ext.isIE8&&Ext.isStrict?null:t,i.callParent([i.animateTarget,function(){i.titleField.focus(!1,100)},i]),e=i.formPanel.form,i.deleteButton[n.data&&n.data[u.EventId.name]?"show":"hide"](),n.data?(r=n,i.setTitle(r.phantom?i.titleTextAdd:i.titleTextEdit),e.loadRecord(r)):(i.setTitle(i.titleTextAdd),f=n[u.StartDate.name],o=n[u.EndDate.name]||Extensible.Date.add(f,{hours:1}),r=Ext.create("Extensible.calendar.data.EventModel"),r.data[u.StartDate.name]=f,r.data[u.EndDate.name]=o,r.data[u.IsAllDay.name]=!!n[u.IsAllDay.name]||f.getDate()!==Extensible.Date.add(o,{millis:1}).getDate(),r.data[u.CalendarId.name]=i.calendarStore?i.calendarStore.getAt(0).data[Extensible.calendar.data.CalendarMappings.CalendarId.name]:"",u.Duration&&(r.data[u.Duration.name]=Extensible.Date.diff(f,o,Extensible.calendar.data.EventModel.resolution)),e.reset(),e.loadRecord(r)),u.RInstanceStartDate&&(r.data[u.RInstanceStartDate.name]=r.getStartDate()),i.dateRangeField.setValue(r.data),i.activeRecord=r,e.getFields().each(function(n){n.resetOriginalValue()}),i},roundTime:function(n,t){t=t||15;var i=parseInt(n.getMinutes(),10);return n.add("mi",t-i%t)},onCancel:function(){this.cleanup(!0),this.fireEvent("eventcancel",this,this.activeRecord,this.animateTarget)},cleanup:function(n){this.activeRecord&&this.activeRecord.reject(),delete this.activeRecord,n===!0&&this.hide()},updateRecord:function(n,t){var a=n.fields,h=this.formPanel.getForm().getValues(),r=Extensible.calendar.data.EventMappings,f,i={},l;a.each(function(n){f=n.name,f in h&&(i[f]=h[f])});var u=this.dateRangeField.getValue(),e=i[r.IsAllDay.name]=u[2],s=e?Extensible.Date.clearTime(u[0]):u[0],o=e?Extensible.Date.clearTime(u[1]):u[1],c={days:1};return c[Extensible.calendar.data.EventModel.resolution]=-1,i[r.StartDate.name]=s,i[r.EndDate.name]=e?Extensible.Date.add(o,c):o,r.Duration&&(i[r.Duration.name]=Extensible.Date.diff(s,i[r.EndDate.name],Extensible.calendar.data.EventModel.resolution)),n.beginEdit(),n.set(i),t&&l||n.endEdit(),n.dirty||n.phantom&&this.allowDefaultAdd},onSave:function(){var n=this,t=n.formPanel.form,i=n.activeRecord.isRecurring();if(!t.isDirty()&&!n.allowDefaultAdd){n.onCancel();return}if(t.isValid()){if(!n.updateRecord(n.activeRecord)){n.onCancel();return}n.activeRecord.phantom?n.fireEvent("eventadd",n,n.activeRecord,n.animateTarget):i?n.onRecurrenceUpdate():n.fireEvent("eventupdate",n,n.activeRecord,n.animateTarget)}},onRecurrenceUpdate:function(){Extensible.form.recurrence.RangeEditWindow.prompt({callback:this.onRecurrenceEditModeSelected,scope:this})},onRecurrenceEditModeSelected:function(n){var t=this;n&&(t.activeRecord.data[Extensible.calendar.data.EventMappings.REditMode.name]=n,t.fireEvent("eventupdate",t,t.activeRecord,t.animateTarget))},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord,this.animateTarget)}}),Ext.define("Extensible.calendar.view.AbstractCalendar",{extend:"Ext.Component",requires:["Ext.CompositeElement","Extensible.calendar.form.EventDetails","Extensible.calendar.form.EventWindow","Extensible.calendar.menu.Event","Extensible.calendar.dd.DragZone","Extensible.calendar.dd.DropZone","Extensible.form.recurrence.RangeEditWindow"],recurrence:!1,recurrenceOptions:{expansionMode:"remote",expansionParam:{name:"singleEvents",value:!0}},startDay:0,spansHavePriority:!1,trackMouseOver:!0,enableFx:!0,enableAddFx:!0,enableUpdateFx:!1,enableRemoveFx:!0,enableDD:!0,enableContextMenus:!0,suppressBrowserContextMenu:!1,monitorResize:!0,todayText:"Today",ddCreateEventText:"Create event for {0}",ddCopyEventText:"Copy event to {0}",ddMoveEventText:"Move event to {0}",ddResizeEventText:"Update event to {0}",defaultEventTitleText:"(No title)",dateParamStart:"startDate",dateParamEnd:"endDate",dateParamFormat:"Y-m-d",editModal:!1,enableEditDetails:!0,weekendCls:"ext-cal-day-we",prevMonthCls:"ext-cal-day-prev",nextMonthCls:"ext-cal-day-next",todayCls:"ext-cal-day-today",hideMode:"offsets",notifyOnExceptionTitle:"Server Error",notifyOnExceptionText:"The action failed with the following response:",notifyOnExceptionDefaultMessage:"An unknown error occurred",weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventSelectorDepth:10,eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",recurringInstanceIdDelimiter:"-rid-",getEventBodyMarkup:Ext.emptyFn,getEventTemplate:Ext.emptyFn,initComponent:function(){this.setStartDate(this.startDate||new Date),this.callParent(arguments),this.readOnly===!0&&this.addCls("ext-cal-readonly"),this.addEvents({eventsrendered:!0,eventclick:!0,eventover:!0,eventout:!0,beforedatechange:!0,datechange:!0,rangeselect:!0,beforeeventcopy:!0,eventcopy:!0,beforeeventmove:!0,eventmove:!0,initdrag:!0,dayover:!0,dayout:!0,editdetails:!0,eventadd:!0,eventupdate:!0,eventcancel:!0,beforeeventdelete:!0,eventdelete:!0,eventexception:!0})},afterRender:function(){this.callParent(arguments),this.renderTemplate(),this.store&&(this.setStore(this.store,!0),this.store.deferLoad?(this.reloadStore(this.store.deferLoad),delete this.store.deferLoad):this.store.initialParams=this.getStoreParams()),this.calendarStore&&this.setCalendarStore(this.calendarStore,!0);this.on("resize",this.onResize,this);this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,click:this.onClick,scope:this});if(this.enableContextMenus&&this.readOnly!==!0)this.el.on("contextmenu",this.onContextMenu,this);this.el.unselectable(),this.enableDD&&this.readOnly!==!0&&this.initDD&&this.initDD();this.on("eventsrendered",this.onEventsRendered);Ext.defer(this.forceSize,100,this)},getStoreDateParams:function(){var n={};return n[this.dateParamStart]=Ext.Date.format(this.viewStart,this.dateParamFormat),n[this.dateParamEnd]=Ext.Date.format(this.viewEnd,this.dateParamFormat),n},getStoreParams:function(){return this.getStoreDateParams()},reloadStore:function(n){Extensible.log("reloadStore");var t=this.recurrenceOptions;n=Ext.isObject(n)?n:{},n.params=n.params||{},Ext.apply(n.params,this.getStoreParams()),this.recurrence&&t.expansionParam&&t.expansionMode==="remote"&&(n.params[t.expansionParam.name]=t.expansionParam.value),this.store.load(n)},onEventsRendered:function(){this.forceSize()},forceSize:function(){var n=this.el,i,t,u,r;if(n&&n.down){if(i=n.down(".ext-cal-hd-ct"),t=n.down(".ext-cal-body-ct"),!t||!i)return;u=i.getHeight(),r=n.parent().getSize(),t.setHeight(r.height-u)}},refresh:function(n){if(!this.isActiveView()){Extensible.log("refresh (AbstractCalendar), skipped for non-active view ("+this.id+")");return}Extensible.log("refresh (AbstractCalendar), reload = "+n),n===!0?this.reloadStore():(this.prepareData(),this.renderTemplate(),this.renderItems())},getWeekCount:function(){var n=Extensible.Date.diffDays(this.viewStart,this.viewEnd);return Math.ceil(n/this.dayCount)},prepareData:function(){var e=Ext.Date.getLastDateOfMonth(this.startDate),n=0,t=0,s=0,i=Ext.Date.clone(this.viewStart),o=this.weekCount<1?6:this.weekCount,r,f,u;for(this.eventGrid=[[]],this.allDayGrid=[[]],this.evtMaxCount=[],r=this.store.queryBy(function(n){return this.isEventVisible(n.data)},this),f=function(r){var u=Extensible.calendar.data.EventMappings,o=Ext.Date.clearTime(r.data[u.StartDate.name],!0),e=i.getTime()===o.getTime(),f=n===0&&t===0&&i>r.data[u.StartDate.name];return e||f};n<o;n++){if(this.evtMaxCount[n]=this.evtMaxCount[n]||0,this.weekCount===-1&&i>e)break;for(this.eventGrid[n]=this.eventGrid[n]||[],this.allDayGrid[n]=this.allDayGrid[n]||[],t=0;t<this.dayCount;t++)r.getCount()>0&&(u=r.filterBy(f,this),this.sortEventRecordsForDay(u),this.prepareEventGrid(u,n,t)),i=Extensible.Date.add(i,{days:1})}this.currentWeekCount=n},prepareEventGrid:function(n,t,i){var r=this,u=0,e=Ext.Date.clone(r.viewStart),f;n.each(function(n){var f=Extensible.calendar.data.EventMappings,e;return Extensible.Date.diffDays(n.data[f.StartDate.name],n.data[f.EndDate.name])>0?(e=Extensible.Date.diffDays(Extensible.Date.max(r.viewStart,n.data[f.StartDate.name]),Extensible.Date.min(r.viewEnd,n.data[f.EndDate.name]))+1,r.prepareEventGridSpans(n,r.eventGrid,t,i,e),r.prepareEventGridSpans(n,r.allDayGrid,t,i,e,!0)):(u=r.findEmptyRowIndex(t,i),r.eventGrid[t][i]=r.eventGrid[t][i]||[],r.eventGrid[t][i][u]=n,n.data[f.IsAllDay.name]&&(u=r.findEmptyRowIndex(t,i,!0),r.allDayGrid[t][i]=r.allDayGrid[t][i]||[],r.allDayGrid[t][i][u]=n)),r.setMaxEventsForDay(t,i),!0},r)},setMaxEventsForDay:function(n,t){var r=this.maxEventsPerDay+1||999,i=this[this.isHeaderView?"allDayGrid":"eventGrid"][n][t]||[];this.evtMaxCount[n]=this.evtMaxCount[n]||0,i.length&&this.evtMaxCount[n]<i.length&&(this.evtMaxCount[n]=Math.min(r,i.length))},prepareEventGridSpans:function(n,t,i,r,u,f){var o=i,e=r,h=this.findEmptyRowIndex(i,r,f),s=Ext.Date.clone(this.viewStart),c={event:n,isSpan:!0,isSpanStart:!0,spanLeft:!1,spanRight:r===6};for(t[i][r]=t[i][r]||[],t[i][r][h]=c,this.setMaxEventsForDay(i,r);--u;){if(s=Extensible.Date.add(s,{days:1}),s>this.viewEnd)break;++e>6&&(e=0,o++,h=this.findEmptyRowIndex(o,0)),t[o]=t[o]||[],t[o][e]=t[o][e]||[],t[o][e][h]={event:n,isSpan:!0,isSpanStart:e===0,spanLeft:o>i&&e%7==0,spanRight:e===6&&u>1},this.setMaxEventsForDay(o,e)}},findEmptyRowIndex:function(n,t,i){for(var f=i?this.allDayGrid:this.eventGrid,e=f[n]?f[n][t]||[]:[],r=0,u=e.length;r<u;r++)if(e[r]===null)return r;return u},renderTemplate:function(){this.tpl&&(this.tpl.overwrite(this.el,this.getTemplateParams()),this.lastRenderStart=Ext.Date.clone(this.viewStart),this.lastRenderEnd=Ext.Date.clone(this.viewEnd))},getTemplateParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,weekendCls:this.weekendCls,prevMonthCls:this.prevMonthCls,nextMonthCls:this.nextMonthCls,todayCls:this.todayCls}},disableStoreEvents:function(){return this.monitorStoreEvents=!1,this},enableStoreEvents:function(n){return this.monitorStoreEvents=!0,n===!0&&this.refresh(),this},onResize:function(){this.refresh(!1)},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(n,t,i){this[(i||"move")+"Event"](n,t)},onCalendarEndDrag:function(n,t,i){this.dragPending=!0;var u={},r=Ext.bind(this.onCalendarEndDragComplete,this,[i]);if(u[Extensible.calendar.data.EventMappings.StartDate.name]=n,u[Extensible.calendar.data.EventMappings.EndDate.name]=t,this.fireEvent("rangeselect",this,u,r)!==!1)if(this.showEventEditor(u,null),this.editWin)this.editWin.on("hide",r,this,{single:!0});else r();else this.onCalendarEndDragComplete(r)},onCalendarEndDragComplete:function(n){n(),this.dragPending=!1},storeReloadRequired:function(n,t){return t.records[0].isRecurring()},onUpdate:function(n,t,i){if(this.hidden!==!0&&this.monitorStoreEvents!==!1&&i===Ext.data.Record.COMMIT){Extensible.log("onUpdate"),this.dismissEventEditor(),this.refresh(this.storeReloadRequired("update",t));var r=t.records[0];this.enableFx&&this.enableUpdateFx&&this.doUpdateFx(this.getEventEls(r.data[Extensible.calendar.data.EventMappings.EventId.name]),{scope:this})}},doUpdateFx:function(n,t){this.highlightEvent(n,null,t)},onAdd:function(n,t){var i=t.records[0];this.hidden!==!0&&this.monitorStoreEvents!==!1&&(Extensible.log("onAdd"),this.dismissEventEditor(),this.refresh(this.storeReloadRequired("create",t)))},doAddFx:function(n,t){n.fadeIn(Ext.apply(t,{duration:2e3}))},onRemove:function(n,t){if(this.hidden!==!0&&this.monitorStoreEvents!==!1){Extensible.log("onRemove"),this.dismissEventEditor();var r=this.storeReloadRequired("delete",t),i=t.records[0];this.enableFx&&this.enableRemoveFx?this.doRemoveFx(this.getEventEls(i.data[Extensible.calendar.data.EventMappings.EventId.name]),{remove:!0,scope:this,callback:Ext.bind(this.refresh,this,[r])}):(this.getEventEls(i.data[Extensible.calendar.data.EventMappings.EventId.name]).remove(),this.refresh(r))}},doRemoveFx:function(n,t){n.getCount()===0&&Ext.isFunction(t.callback)?t.callback.call(t.scope||this):n.fadeOut(t)},highlightEvent:function(n,t,i){if(this.enableFx)if(Ext.isIE||Ext.isOpera){var r;n.each(function(n){n.highlight(t,Ext.applyif({attr:"color"},i));var r=n.down(".ext-cal-evm");r&&r.highlight(t,i)},this)}else n.highlight(t,i)},getEventIdFromEl:function(n){n=Ext.get(n);var t,i="",u,r=n.dom.className.split(" ");return Ext.each(r,function(n){return t=n.split(this.eventElIdDelimiter),t.length>1?(i=t[1],!1):void 0},this),i},getEventId:function(n){return n===undefined&&this.tempEventId&&(n=this.tempEventId),n},getEventSelectorCls:function(n,t){var u=t?".":"",r=this.getEventId(n);return u+this.id+this.eventElIdDelimiter+r},getEventEls:function(n){var t=this.el.select(this.getEventSelectorCls(this.getEventId(n),!0),!1);return Ext.create("Ext.CompositeElement",t)},isToday:function(){var n=Ext.Date.clearTime(new Date).getTime();return this.viewStart.getTime()<=n&&this.viewEnd.getTime()>=n},isEventVisible:function(n){var t=Extensible.calendar.data.EventMappings,r=n.data||n,i=this.calendarStore?this.calendarStore.findRecord(t.CalendarId.name,n[t.CalendarId.name]):null;if(i&&i.data[Extensible.calendar.data.CalendarMappings.IsHidden.name]===!0)return!1;var e=this.viewStart.getTime(),o=this.viewEnd.getTime(),u=r[t.StartDate.name].getTime(),f=r[t.EndDate.name].getTime();return Extensible.Date.rangesOverlap(e,o,u,f)},isOverlapping:function(n,t){var o=n.data?n.data:n,s=t.data?t.data:t,i=Extensible.calendar.data.EventMappings,h=o[i.StartDate.name].getTime(),e=Extensible.Date.add(o[i.EndDate.name],{seconds:-1}).getTime(),r=s[i.StartDate.name].getTime(),f=Extensible.Date.add(s[i.EndDate.name],{seconds:-1}).getTime(),c=Extensible.Date.diff(o[i.StartDate.name],s[i.StartDate.name],"m");e<h&&(e=h),f<r&&(f=r);var a=Extensible.Date.rangesOverlap(h,e,r,f),u=this.minEventDisplayMinutes||0,l=u>0&&c>-u&&c<u;return a||l},isEventSpanning:function(n){var r=Extensible.calendar.data.EventMappings,i=n.data||n,t;return t=Extensible.Date.diffDays(i[r.StartDate.name],i[r.EndDate.name]),t>0},getDayEl:function(n){return Ext.get(this.getDayId(n))},getDayId:function(n){return Ext.isDate(n)&&(n=Ext.Date.format(n,"Ymd")),this.id+this.dayElIdDelimiter+n},getStartDate:function(){return this.startDate},setStartDate:function(n,t){var i=this;Extensible.log("setStartDate (base) "+Ext.Date.format(n,"Y-m-d"));var r=Ext.Date.clone,e=i.startDate?r(i.startDate):null,o=r(n),u=i.viewStart?r(i.viewStart):null,f=i.viewEnd?r(i.viewEnd):null;i.fireEvent("beforedatechange",i,e,o,u,f)!==!1&&(i.startDate=Ext.Date.clearTime(n),i.setViewBounds(n),i.ownerCalendarPanel&&i.ownerCalendarPanel.startDate!==i.startDate&&(i.ownerCalendarPanel.startDate=i.startDate),i.rendered&&i.refresh(t),i.fireEvent("datechange",i,r(i.startDate),r(i.viewStart),r(i.viewEnd)))},setViewBounds:function(n){var t=this,r=n||t.startDate,i=r.getDay()-t.startDay,u=Extensible.Date,f;i<0&&(i+=7);switch(this.weekCount){case 0:case 1:t.viewStart=t.dayCount<7&&!t.startDayIsStatic?r:u.add(r,{days:-i,clearTime:!0}),t.viewEnd=u.add(t.viewStart,{days:t.dayCount||7,seconds:-1});return;case-1:r=Ext.Date.getFirstDateOfMonth(r),i=r.getDay()-t.startDay,i<0&&(i+=7),t.viewStart=u.add(r,{days:-i,clearTime:!0}),f=u.add(r,{months:1,seconds:-1}),i=t.startDay,i>f.getDay()&&(i-=7),t.viewEnd=u.add(f,{days:6-f.getDay()+i});return;default:t.viewStart=u.add(r,{days:-i,clearTime:!0}),t.viewEnd=u.add(t.viewStart,{days:t.weekCount*7,seconds:-1})}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(n){n.length<2||n.sortBy(Ext.bind(function(n,t){var u=n.data,r=t.data,i=Extensible.calendar.data.EventMappings,f;return u[i.IsAllDay.name]?-1:r[i.IsAllDay.name]?1:this.spansHavePriority?(f=Extensible.Date.diffDays,f(u[i.StartDate.name],u[i.EndDate.name])>0)?f(r[i.StartDate.name],r[i.EndDate.name])>0?u[i.StartDate.name].getTime()===r[i.StartDate.name].getTime()?r[i.EndDate.name].getTime()-u[i.EndDate.name].getTime():u[i.StartDate.name].getTime()-r[i.StartDate.name].getTime():-1:f(r[i.StartDate.name],r[i.EndDate.name])>0?1:u[i.StartDate.name].getTime()-r[i.StartDate.name].getTime():u[i.StartDate.name].getTime()-r[i.StartDate.name].getTime()},this))},moveTo:function(n,t){return Ext.isDate(n)?(this.setStartDate(n,t),this.startDate):n},moveNext:function(n){return this.moveTo(Extensible.Date.add(this.viewEnd,{days:1}),n)},movePrev:function(n){var t=Extensible.Date.diffDays(this.viewStart,this.viewEnd)+1;return this.moveDays(-t,n)},moveMonths:function(n,t){return this.moveTo(Extensible.Date.add(this.startDate,{months:n}),t)},moveWeeks:function(n,t){return this.moveTo(Extensible.Date.add(this.startDate,{days:n*7}),t)},moveDays:function(n,t){return this.moveTo(Extensible.Date.add(this.startDate,{days:n}),t)},moveToday:function(n){return this.moveTo(new Date,n)},setStore:function(n,t){var i=this.store;if(!t&&i&&(i.un("load",this.onEventStoreLoad,this),i.un("clear",this.refresh,this),i.un("write",this.onWrite,this),i.getProxy().un("exception",this.onException,this)),n){n.on("load",this.onEventStoreLoad,this);n.on("clear",this.refresh,this);n.on("write",this.onWrite,this);n.getProxy().on("exception",this.onException,this)}this.store=n},onEventStoreLoad:function(){Extensible.log("AbstractCalendar.onEventStoreLoad: store loaded"),this.refresh(!1)},onDataChanged:this.onEventStoreLoad,onException:function(n,t,i){Ext.each(i.records,function(n){n.dirty&&(n.phantom?n.unjoin(this.eventStore):n.reject())},this),this.fireEvent("eventexception",this,t,i)!==!1&&this.notifyOnException(t,i)},getExceptionMessage:function(n){var t="";return n.responseText&&(t+="<br><b>responseText</b>: "+Ext.decode(n.responseText).message),n.message&&(t+="<br><b>message</b>: "+n.message),n.status&&(t+="<br><b>status</b>: "+n.status),n.statusText&&(t+="<br><b>statusText</b>: "+n.statusText),t||"<br>"+this.notifyOnExceptionDefaultMessage},notifyOnException:function(n){Ext.Msg.alert(this.notifyOnExceptionTitle,this.notifyOnExceptionText+"<br>"+this.getExceptionMessage(n))},setCalendarStore:function(n,t){if(!t&&this.calendarStore&&(this.calendarStore.un("datachanged",this.refresh,this),this.calendarStore.un("add",this.refresh,this),this.calendarStore.un("remove",this.refresh,this),this.calendarStore.un("update",this.refresh,this)),n){n.on("datachanged",this.refresh,this);n.on("add",this.refresh,this);n.on("remove",this.refresh,this);n.on("update",this.refresh,this)}this.calendarStore=n},getEventRecord:function(n){var t=this.store.find(Extensible.calendar.data.EventMappings.EventId.name,n,0,!1,!0,!0);return this.store.getAt(t)},getEventRecordFromEl:function(n){return this.getEventRecord(this.getEventIdFromEl(n))},getEventEditor:function(){return this.editWin=this.editWin||Ext.WindowMgr.get("ext-cal-editwin"),this.editWin||(this.editWin=Ext.create("Extensible.calendar.form.EventWindow",{id:"ext-cal-editwin",calendarStore:this.calendarStore,modal:this.editModal,enableEditDetails:this.enableEditDetails,listeners:{eventadd:{fn:function(n,t,i,r){n.currentView.onEventEditorAdd(null,t,r)},scope:this},eventupdate:{fn:function(n,t,i,r){n.currentView.onEventEditorUpdate(null,t,r)},scope:this},eventdelete:{fn:function(n,t,i,r){n.currentView.onEventEditorDelete(null,t,r)},scope:this},editdetails:{fn:function(n,t){n.animateTarget=null,n.hide(),n.currentView.fireEvent("editdetails",n.currentView,t)},scope:this},eventcancel:{fn:function(n,t,i){this.dismissEventEditor(null,i),n.currentView.onEventEditorCancel()},scope:this}}})),this.editWin.currentView=this,this.editWin},showEventEditor:function(n,t){return this.getEventEditor().show(n,t,this),this},dismissEventEditor:function(n,t){this.newRecord&&this.newRecord.phantom&&this.store.remove(this.newRecord),delete this.newRecord;var i=Ext.WindowMgr.get("ext-cal-editwin");return i&&i[n?n:"hide"](t),this},save:function(){this.store.autoSync||this.store.sync()},onWrite:function(n,t){if(t.wasSuccessful())switch(t.action){case"create":this.onAdd(n,t);break;case"update":this.onUpdate(n,t,Ext.data.Record.COMMIT);break;case"destroy":this.onRemove(n,t)}},onEventEditorAdd:function(n,t){this.newRecord=t,this.store.indexOf(t)===-1&&this.store.add(t),this.save(),this.fireEvent("eventadd",this,t)},onEventEditorUpdate:function(n,t){this.save(),this.fireEvent("eventupdate",this,t)},onEventEditorDelete:function(n,t){t._deleting=!0,this.deleteEvent(t)},onEventEditorCancel:function(n,t){this.fireEvent("eventcancel",this,t)},onDayClick:function(n,t,i){if(this.readOnly!==!0&&this.fireEvent("dayclick",this,Ext.Date.clone(n),t,i)!==!1){var u=Extensible.calendar.data.EventMappings,r={};r[u.StartDate.name]=n,r[u.IsAllDay.name]=t,this.showEventEditor(r,i)}},showEventMenu:function(n,t){var i=this;i.eventMenu||(i.eventMenu=Ext.create("Extensible.calendar.menu.Event",{listeners:{editdetails:Ext.bind(i.onEditDetails,i),eventdelete:Ext.bind(i.onDeleteEvent,i),eventmove:Ext.bind(i.onMoveEvent,i),eventcopy:Ext.bind(i.onCopyEvent,i)}})),i.eventMenu.showForEvent(i.getEventRecordFromEl(n),n,t),i.menuActive=!0},onCopyEvent:function(n,t,i){this.menuActive=!1,this.shiftEvent(t,i,"copy")},onMoveEvent:function(n,t,i){this.menuActive=!1,this.shiftEvent(t,i,"move")},copyEvent:function(n,t){this.shiftEvent(n,t,"copy")},moveEvent:function(n,t){this.shiftEvent(n,t,"move")},shiftEvent:function(n,t,i){var u=this,r;if(i==="move"){if(Extensible.Date.compare(n.getStartDate(),t)===0)return;r=n}else r=n.clone();if(u.fireEvent("beforeevent"+i,u,r,Ext.Date.clone(t))!==!1)if(r.isRecurring())u.onRecurrenceEditModeSelected("single",r,t,i);else u.doShiftEvent(r,t,i)},onRecurrenceEditModeSelected:function(n,t,i,r){var u=Extensible.calendar.data.EventMappings;n&&(r==="copy"&&t.clearRecurrence(),t.data[u.REditMode.name]=n,t.data[u.RInstanceStartDate.name]=t.getStartDate(),this.doShiftEvent(t,i,r))},doShiftEvent:function(n,t,i){var u=Extensible.calendar.data.EventMappings,f=t.getTime()-n.getStartDate().getTime(),r={};r[u.StartDate.name]=t,r[u.EndDate.name]=Extensible.Date.add(n.getEndDate(),{millis:f}),n.set(r),n.phantom&&this.store.add(n),this.save(),this.fireEvent("event"+i,this,n)},onEditDetails:function(n,t,i){this.fireEvent("editdetails",this,t,i),this.menuActive=!1},onDeleteEvent:function(n,t,i){t._deleting=!0,this.deleteEvent(t,i),this.menuActive=!1},deleteEvent:function(n,t){var i=this;i.fireEvent("beforeeventdelete",i,n,t)!==!1&&(n.isRecurring()?Extensible.form.recurrence.RangeEditWindow.prompt({callback:Ext.bind(i.onRecurrenceDeleteModeSelected,i,[n,t],!0),scope:i}):i.doDeleteEvent(n,t))},onRecurrenceDeleteModeSelected:function(n,t,i){n&&(t.data[Extensible.calendar.data.EventMappings.REditMode.name]=n,t.data[Extensible.calendar.data.EventMappings.RInstanceStartDate.name]=t.getStartDate(),this.doDeleteEvent(t,i))},doDeleteEvent:function(n,t){this.store.remove(n),this.save(),this.fireEvent("eventdelete",this,n,t)},onContextMenu:function(n){var r=n.getTarget(this.eventSelector,5,!0),i=!1;r&&(this.dismissEventEditor().showEventMenu(r,n.getXY()),i=!0),(i||this.suppressBrowserContextMenu===!0)&&n.preventDefault()},onClick:function(n){var i=this,u=n.getTarget(i.eventSelector,5),f,r;return(i.dropZone&&i.dropZone.clearShims(),i.menuActive===!0)?(i.menuActive=!1,!0):u?(f=i.getEventIdFromEl(u),r=i.getEventRecord(f),r&&i.fireEvent("eventclick",i,r,u)!==!1&&i.readOnly!==!0&&i.showEventEditor(r,u),!0):void 0},onMouseOver:function(n,t){this.trackMouseOver===!1||this.dragZone!==undefined&&this.dragZone.dragging||this.handleEventMouseEvent(n,t,"over")||this.handleDayMouseEvent(n,t,"over")},onMouseOut:function(n,t){this.trackMouseOver===!1||this.dragZone!==undefined&&this.dragZone.dragging||this.handleEventMouseEvent(n,t,"out")||this.handleDayMouseEvent(n,t,"out")},handleEventMouseEvent:function(n,t,i){var r=n.getTarget(this.eventSelector,this.eventSelectorDepth,!0),f,u,e;return r?(f=Ext.get(n.getRelatedTarget()),r===f||r.contains(f))?!0:(u=this.getEventIdFromEl(r),this.eventOverClass!==""&&(e=this.getEventEls(u),e[i==="over"?"addCls":"removeCls"](this.eventOverClass)),this.fireEvent("event"+i,this,this.getEventRecord(u),r),!0):!1},getDateFromId:function(n,t){var i=n.split(t);return i[i.length-1]},handleDayMouseEvent:function(n,t,i){var e,r,f,o,u;t=n.getTarget("td",3),t&&t.id&&t.id.indexOf(this.dayElIdDelimiter)>-1&&(e=this.getDateFromId(t.id,this.dayElIdDelimiter),r=Ext.get(n.getRelatedTarget()),r&&(f=r.is("td")?r:r.up("td",3),o=f&&f.id?this.getDateFromId(f.id,this.dayElIdDelimiter):""),r&&e===o||(u=this.getDayEl(e),u&&this.dayOverClass!==""&&u[i==="over"?"addCls":"removeCls"](this.dayOverClass),this.fireEvent("day"+i,this,Ext.Date.parseDate(e,"Ymd"),u)))},renderItems:function(){throw"This method must be implemented by a subclass";},isActiveView:function(){var n=this.ownerCalendarPanel;return n&&n.getActiveView().id===this.id},destroy:function(){this.callParent(arguments),this.el&&this.el.un("contextmenu",this.onContextMenu,this),Ext.destroy(this.editWin,this.eventMenu,this.dragZone,this.dropZone)}}),Ext.define("Extensible.calendar.view.MonthDayDetail",{extend:"Ext.Component",alias:"widget.extensible.monthdaydetailview",requires:["Ext.XTemplate","Extensible.calendar.view.AbstractCalendar"],initComponent:function(){this.callParent(arguments),this.addEvents({eventsrendered:!0})},afterRender:function(){this.tpl=this.getTemplate(),this.callParent(arguments);this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){return this.tpl||(this.tpl=Ext.create("Ext.XTemplate",'<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>")),this.tpl.compile(),this.tpl},update:function(n){this.date=n,this.refresh()},refresh:function(){if(this.rendered){var t=this.view.getEventTemplate(),n=[];evts=this.store.queryBy(function(n){var i=Ext.Date.clearTime(this.date,!0).getTime(),t=Extensible.calendar.data.EventMappings,e=Ext.Date.clearTime(n.data[t.StartDate.name],!0).getTime(),o=i==e,f=!1,s=n.data[t.CalendarId.name],r=this.calendarStore?this.calendarStore.getById(s):null,u;return r&&r.data[Extensible.calendar.data.CalendarMappings.IsHidden.name]===!0?!1:(o||(u=Ext.Date.clearTime(n.data[t.EndDate.name],!0).getTime(),f=e<i&&u>=i),o||f)},this),Extensible.calendar.view.AbstractCalendar.prototype.sortEventRecordsForDay.call(this,evts),evts.each(function(i){var r=i.data,u=Extensible.calendar.data.EventMappings;r._renderAsAllDay=r[u.IsAllDay.name]||Extensible.Date.diffDays(r[u.StartDate.name],r[u.EndDate.name])>0,r.spanLeft=Extensible.Date.diffDays(r[u.StartDate.name],this.date)>0,r.spanRight=Extensible.Date.diffDays(this.date,r[u.EndDate.name])>0,r.spanCls=r.spanLeft?r.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":r.spanRight?"ext-cal-ev-spanright":"",n.push({markup:t.apply(this.getTemplateEventData(r))})},this),this.tpl.overwrite(this.el,n),this.fireEvent("eventsrendered",this,this.date,evts.getCount())}},getTemplateEventData:function(n){var t=this.view.getTemplateEventData(n);return t._elId="dtl-"+t._elId,t}}),Ext.define("Extensible.calendar.view.Month",{extend:"Extensible.calendar.view.AbstractCalendar",alias:"widget.extensible.monthview",requires:["Ext.XTemplate","Extensible.calendar.template.Month","Extensible.calendar.util.WeekEventRenderer","Extensible.calendar.view.MonthDayDetail"],moreText:"+{0} more...",detailsTitleDateFormat:"F j",showTime:!0,showTodayText:!0,showHeader:!1,showWeekLinks:!1,showWeekNumbers:!1,weekLinkOverClass:"ext-week-link-over",morePanelMinWidth:220,daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){this.callParent(arguments),this.addEvents({dayclick:!0,weekclick:!0,dayover:!0,dayout:!0})},initDD:function(){var n={view:this,createText:this.ddCreateEventText,copyText:this.ddCopyEventText,moveText:this.ddMoveEventText,ddGroup:this.ddGroup||this.id+"-MonthViewDD"};this.dragZone=Ext.create("Extensible.calendar.dd.DragZone",this.el,n),this.dropZone=Ext.create("Extensible.calendar.dd.DropZone",this.el,n)},onDestroy:function(){Ext.destroy(this.ddSelector),Ext.destroy(this.dragZone),Ext.destroy(this.dropZone),this.callParent(arguments)},afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.Month",{id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers}),this.tpl.compile()),this.addCls("ext-cal-monthview ext-cal-ct"),this.callParent(arguments)},onResize:function(){this.monitorResize&&(this.maxEventsPerDay=this.getMaxEventsPerDay(),this.refresh(!1))},forceSize:function(){if(this.showWeekLinks&&this.el){var i=this.el.down(".ext-cal-hd-days-tbl"),r=this.el.select(".ext-cal-bg-tbl"),u=this.el.select(".ext-cal-evt-tbl"),t=this.el.down(".ext-cal-week-link").getWidth(),n=this.el.getWidth()-t;i.setWidth(n),r.setWidth(n),u.setWidth(n)}this.callParent(arguments)},initClock:function(){Ext.fly(this.id+"-clock")!==null&&(this.prevClockDay=(new Date).getDay(),this.clockTask&&Ext.TaskManager.stop(this.clockTask),this.clockTask=Ext.TaskManager.start({run:function(){var t=Ext.fly(this.id+"-clock"),n=new Date;n.getDay()==this.prevClockDay?t&&t.update(Ext.Date.format(n,Extensible.Date.use24HourTime?"G:i":"g:ia")):(this.prevClockDay=n.getDay(),this.moveTo(n))},scope:this,interval:1e3}))},getMoreText:function(){return this.moreText},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>",'<tpl if="spanLeft">','<i class="ext-cal-spl">&#160;</i>',"</tpl>",'<tpl if="spanRight">','<i class="ext-cal-spr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var n,t=this.getEventBodyMarkup();n=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<tpl if="_renderAsAllDay">','<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div class="{_extraCls} ext-cal-evt ext-cal-evr">',"</tpl>",t,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>"):Ext.create("Ext.XTemplate",'<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr">',t,"</div>"),n.compile(),this.eventTpl=n}return this.eventTpl},getTemplateEventData:function(n){var t=Extensible.calendar.data.EventMappings,u=[this.getEventSelectorCls(n[t.EventId.name])],i={},h=n[t.RRule.name]!="",e="x-cal-default",f=n[t.Title.name],s=Extensible.Date.use24HourTime?"G:i ":"g:ia ",r,o;return this.calendarStore&&n[t.CalendarId.name]&&(r=this.calendarStore.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,n[t.CalendarId.name]),r&&(e="x-cal-"+r.data[Extensible.calendar.data.CalendarMappings.ColorId.name])),e+=n._renderAsAllDay?"-ad":"",u.push(e),n._renderAsAllDay&&u.push("ext-evt-block"),this.getEventClass&&(r=this.getEventRecord(n[t.EventId.name]),o=this.getEventClass(r,!!n._renderAsAllDay,i,this.store),u.push(o)),i._extraCls=u.join(" "),i._isRecurring=n[t.RRule.name]&&n[t.RRule.name]!="",i._isReminder=n[t.Reminder.name]&&n[t.Reminder.name]!="",i.Title=(n[t.IsAllDay.name]?"":Ext.Date.format(n[t.StartDate.name],s))+(!f||f.length==0?this.defaultEventTitleText:f),Ext.applyIf(i,n)},refresh:function(){Extensible.log("refresh (MonthView)"),this.detailPanel&&this.detailPanel.hide(),this.callParent(arguments),this.showTime!==!1&&this.initClock()},renderItems:function(){Extensible.calendar.util.WeekEventRenderer.render({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,viewId:this.id,templateDataFn:Ext.bind(this.getTemplateEventData,this),evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount,getMoreText:Ext.bind(this.getMoreText,this)}),this.fireEvent("eventsrendered",this)},getDayEl:function(n){return Ext.get(this.getDayId(n))},getDayId:function(n){return Ext.isDate(n)&&(n=Ext.Date.format(n,"Ymd")),this.id+this.dayElIdDelimiter+n},getWeekIndex:function(n){var t=this.getDayEl(n).up(".ext-cal-wk-ct");return parseInt(t.id.split("-wk-")[1])},getDaySize:function(n){var u=this.el.getBox(),r=this.getViewPadding(),f=(u.width-r.width)/this.dayCount,t=(u.height-r.height)/this.getWeekCount(),i;return n&&(i=this.el.select(".ext-cal-dtitle").last().parent("tr"),t=i?t-i.getHeight(!0):t),{height:t,width:f}},getEventHeight:function(){if(!this.eventHeight){var n=this.el.select(".ext-cal-evt").first();if(n)this.eventHeight=n.parent("td").getHeight();else return 16}return this.eventHeight},getMaxEventsPerDay:function(){var i=this.getDaySize(!0).height,n=this.getEventHeight();return Math.max(Math.floor((i-n)/n),0)},getViewPadding:function(n){var n=n||"tlbr",r=n.indexOf("t")>-1,i=n.indexOf("l")>-1,f=n.indexOf("r")>-1,u=this.showHeader&&r?this.el.select(".ext-cal-hd-days-tbl").first().getHeight():0,t=0;return this.isHeaderView?(i&&(t=this.el.select(".ext-cal-gutter").first().getWidth()),f&&(t+=this.el.select(".ext-cal-gutter-rt").first().getWidth())):this.showWeekLinks&&i&&(t=this.el.select(".ext-cal-week-link").first().getWidth()),{height:u,width:t}},getDayAt:function(n,t){var u=this.el.getBox(),f=this.getViewPadding("tl"),i=this.getDaySize(),s=Math.floor((n-u.x-f.width)/i.width),e=Math.floor((t-u.y-f.height)/i.height),o=e*7+s,r=Extensible.Date.add(this.viewStart,{days:o});return{date:r,el:this.getDayEl(r)}},moveNext:function(){return this.moveMonths(1,!0)},movePrev:function(){return this.moveMonths(-1,!0)},onInitDrag:function(){this.callParent(arguments),Ext.select(this.daySelector).removeCls(this.dayOverClass),this.detailPanel&&this.detailPanel.hide()},onMoreClick:function(n){if(this.detailPanel)this.detailPanel.setTitle(Ext.Date.format(n,this.detailsTitleDateFormat));else if(this.detailPanel=Ext.create("Ext.Panel",{id:this.id+"-details-panel",title:Ext.Date.format(n,this.detailsTitleDateFormat),layout:"fit",floating:!0,renderTo:Ext.getBody(),hideMode:"offsets",tools:[{type:"close",handler:function(n,t,i){i.ownerCt.hide()}}],items:{xtype:"extensible.monthdaydetailview",id:this.id+"-details-view",date:n,view:this,store:this.store,calendarStore:this.calendarStore,listeners:{eventsrendered:Ext.bind(this.onDetailViewUpdated,this)}}}),this.enableContextMenus&&this.readOnly!==!0)this.detailPanel.body.on("contextmenu",this.onContextMenu,this);this.detailPanel.getComponent(this.id+"-details-view").update(n)},onDetailViewUpdated:function(n,t){var r=this.detailPanel,o=this.getDayEl(t),l=o.getBox(),h=r.el.down(".ext-cal-mdv").getHeight(),c=r.getDockedItems("header")[0],u=r.frameSize||{top:0,bottom:0},a=u.top+u.bottom+c.getHeight(),s=h+a+5,f=Ext.getBody().getHeight()-20,e=Math.min(s,f);e===f?r.body.addCls("ext-cal-overflow-y"):r.body.removeCls("ext-cal-overflow-y"),r.setWidth(Math.max(l.width,this.morePanelMinWidth)),r.setHeight(e),r.show(),r.getPositionEl().alignTo(o,"t-t?")},onHide:function(){this.callParent(arguments),this.detailPanel&&this.detailPanel.hide()},onClick:function(n){var r,i;if(this.detailPanel&&this.detailPanel.hide(),el=n.getTarget(this.moreSelector,3)){i=el.id.split(this.moreElIdDelimiter)[1];this.onMoreClick(Ext.Date.parseDate(i,"Ymd"));return}if(el=n.getTarget(this.weekLinkSelector,3)){i=el.id.split(this.weekLinkIdDelimiter)[1],this.fireEvent("weekclick",this,Ext.Date.parseDate(i,"Ymd"));return}if(!Extensible.calendar.view.Month.superclass.onClick.apply(this,arguments)&&(el=n.getTarget("td",3))&&el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){r=el.id.split(this.dayElIdDelimiter),i=r[r.length-1];this.onDayClick(Ext.Date.parseDate(i,"Ymd"),!1,Ext.get(this.getDayId(i)));return}},handleDayMouseEvent:function(n,t,i){var r=n.getTarget(this.weekLinkSelector,3,!0);if(r){r[i=="over"?"addCls":"removeCls"](this.weekLinkOverClass);return}this.callParent(arguments)},destroy:function(){this.callParent(arguments),this.detailsPanel&&this.detailPanel.body.un("contextmenu",this.onContextMenu,this)}}),Ext.define("Extensible.calendar.view.DayHeader",{extend:"Extensible.calendar.view.Month",alias:"widget.extensible.dayheaderview",requires:["Extensible.calendar.template.DayHeader"],weekCount:1,dayCount:1,allDayOnly:!0,monitorResize:!1,isHeaderView:!0,afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.DayHeader",{id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime})),this.tpl.compile(),this.addCls("ext-cal-day-header"),this.callParent(arguments)},forceSize:Ext.emptyFn,refresh:function(){Extensible.log("refresh (DayHeaderView)"),this.callParent(arguments),this.recalcHeaderBox()},recalcHeaderBox:function(){var t=this.el.down(".ext-cal-evt-tbl"),n=t.getHeight();this.el.setHeight(n+7),this.el.down(".ext-cal-hd-ad-inner").setHeight(n+5),this.el.down(".ext-cal-bg-tbl").setHeight(n+5)},moveNext:function(){return this.moveDays(this.dayCount,!1)},movePrev:function(){return this.moveDays(-this.dayCount,!1)},onClick:function(n){if((el=n.getTarget("td",3))&&el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){var r=el.id.split(this.dayElIdDelimiter),i=r[r.length-1];this.onDayClick(Ext.Date.parseDate(i,"Ymd"),!0,Ext.get(this.getDayId(i,!0)));return}this.callParent(arguments)},isActiveView:function(){var n=this.ownerCalendarPanel;return n&&n.getActiveView().isDayView}}),Ext.define("Extensible.calendar.view.DayBody",{extend:"Extensible.calendar.view.AbstractCalendar",alias:"widget.extensible.daybodyview",requires:["Ext.XTemplate","Extensible.calendar.template.DayBody","Extensible.calendar.data.EventMappings","Extensible.calendar.dd.DayDragZone","Extensible.calendar.dd.DayDropZone"],dayColumnElIdDelimiter:"-day-col-",hourIncrement:60,initComponent:function(){this.callParent(arguments),this.readOnly===!0&&(this.enableEventResize=!1),this.incrementsPerHour=this.hourIncrement/this.ddIncrement,this.minEventHeight=this.minEventDisplayMinutes/(this.hourIncrement/this.hourHeight),this.addEvents({beforeeventresize:!0,eventresize:!0,dayclick:!0})},initDD:function(){var n={view:this,createText:this.ddCreateEventText,copyText:this.ddCopyEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText,ddIncrement:this.ddIncrement,ddGroup:this.ddGroup||this.id+"-DayViewDD"};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:this.ddGroup||this.id+"-DayViewDD"},this.dragZone=Ext.create("Extensible.calendar.dd.DayDragZone",this.el,Ext.apply({},n)),this.dropZone=Ext.create("Extensible.calendar.dd.DayDropZone",this.el,n)},refresh:function(){Extensible.log("refresh (DayBodyView)");var t=this.el.getScroll().top;this.callParent(arguments),this.scrollReady&&this.scrollTo(t)},scrollTo:function(n,t){t=t||Ext.isIE||Ext.isOpera,t?Ext.defer(function(){this.el.scrollTo("top",n),this.scrollReady=!0},10,this):(this.el.scrollTo("top",n),this.scrollReady=!0)},afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.DayBody",{id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,hourIncrement:this.hourIncrement,hourHeight:this.hourHeight})),this.tpl.compile(),this.addCls("ext-cal-body-ct"),this.callParent(arguments);var t=Math.max(this.scrollStartHour,this.viewStartHour),n=Math.max(0,t-this.viewStartHour);n>0&&this.scrollTo(n*this.hourHeight)},forceSize:Ext.emptyFn,onEventResize:function(n,t){var i=this,u=Extensible.calendar.data.EventMappings,r=Extensible.Date.compare;if((r(n.getStartDate(),t[u.StartDate.name])!==0||r(n.getEndDate(),t[u.EndDate.name])!==0)&&i.fireEvent("beforeeventresize",i,n,t)!==!1)if(n.isRecurring())if(i.recurrenceOptions.editSingleOnResize)i.onRecurrenceResizeModeSelected("single",n,t);else Extensible.form.recurrence.RangeEditWindow.prompt({callback:Ext.bind(i.onRecurrenceResizeModeSelected,i,[n,t],!0),scope:i});else i.doEventResize(n,t)},onRecurrenceResizeModeSelected:function(n,t,i){var r=Extensible.calendar.data.EventMappings;n&&(t.data[r.REditMode.name]=n,t.data[r.RInstanceStartDate.name]=t.getStartDate(),this.doEventResize(t,i))},doEventResize:function(n,t){var r=Extensible.calendar.data.EventMappings,u=r.StartDate.name,f=r.EndDate.name,i={};i[u]=t[u],i[f]=t[f],r.Duration&&(i[r.Duration.name]=Extensible.Date.diff(t[u],t[f],Extensible.calendar.data.EventModel.resolution)),n.set(i),this.save(),this.fireEvent("eventupdate",this,n),this.fireEvent("eventresize",this,n)},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){return this.eventTpl||(this.eventTpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<div id="{_elId}" class="ext-cal-evt {_extraCls}" ','style="left: {_left}%; width: {_width}%; top: {_top}px;">','<div class="ext-cal-evb">&#160;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd">',this.getEventBodyMarkup(),"</dd>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</dl>",'<div class="ext-cal-evb">&#160;</div>',"</div>"):Ext.create("Ext.XTemplate",'<div id="{_elId}" class="{_extraCls} ext-cal-evt ext-cal-evr" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="ext-evt-bd">',this.getEventBodyMarkup(),"</div>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</div>"),this.eventTpl.compile()),this.eventTpl},getEventAllDayTemplate:function(){if(!this.eventAllDayTpl){var n,t=this.getEventBodyMarkup();n=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<div class="ext-cal-evt" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="{_extraCls} {spanCls} ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',t,"</div>","</div>","</div>","</div>"):Ext.create("Ext.XTemplate",'<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',t,"</div>"),n.compile(),this.eventAllDayTpl=n}return this.eventAllDayTpl},getTemplateEventData:function(n){var t=Extensible.calendar.data.EventMappings,u=[this.getEventSelectorCls(n[t.EventId.name])],i={},e="x-cal-default",f=n[t.Title.name],s=Extensible.Date.use24HourTime?"G:i ":"g:ia ",h=n[t.RRule.name]!=="",r,o;return this.getTemplateEventBox(n),this.calendarStore&&n[t.CalendarId.name]&&(r=this.calendarStore.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,n[t.CalendarId.name]),r&&(e="x-cal-"+r.data[Extensible.calendar.data.CalendarMappings.ColorId.name])),e+=(n._renderAsAllDay?"-ad":"")+(Ext.isIE||Ext.isOpera?"-x":""),u.push(e),u.push("ext-evt-block"),this.getEventClass&&(r=this.getEventRecord(n[t.EventId.name]),o=this.getEventClass(r,!!n._renderAsAllDay,i,this.store),u.push(o)),i._extraCls=u.join(" "),i._isRecurring=n[t.RRule.name]&&n[t.RRule.name]!=="",i._isReminder=n[t.Reminder.name]&&n[t.Reminder.name]!=="",i.Title=(n[t.IsAllDay.name]?"":Ext.Date.format(n[t.StartDate.name],s))+(!f||f.length===0?this.defaultEventTitleText:f),Ext.applyIf(i,n)},getEventPositionOffsets:function(){return{top:0,height:-1}},getTemplateEventBox:function(n){var e=this.hourHeight/this.hourIncrement,r=n[Extensible.calendar.data.EventMappings.StartDate.name],t=n[Extensible.calendar.data.EventMappings.EndDate.name],o=Math.max(r.getHours()-this.viewStartHour,0),h=Math.min(t.getHours()-this.viewStartHour,this.viewEndHour-this.viewStartHour),i=o*this.hourIncrement,u=h*this.hourIncrement,s=Extensible.Date.add(Ext.Date.clone(t),{hours:this.viewEndHour,clearTime:!0}),f=this.getEventPositionOffsets();r.getHours()>=this.viewStartHour&&(i+=r.getMinutes()),t<=s&&(u+=t.getMinutes()),n._left=0,n._width=100,n._top=i*e+f.top,n._height=Math.max((u-i)*e,this.minEventHeight)+f.height},renderItems:function(){for(var s=0,n,u=[],o,w,v,y;s<this.dayCount;s++)for(var h=0,tt=0,it=0,c=this.eventGrid[0][s],p=c?c.length:0;h<p;h++)if(n=c[h],n){var l=n.data||n.event.data,k=Extensible.calendar.data.EventMappings,g=l[k.IsAllDay.name]===!0,b=this.isEventSpanning(n.event||n),d=g||b;d||(Ext.apply(l,{cls:"ext-cal-ev",_positioned:!0}),u.push({data:this.getTemplateEventData(l),date:Extensible.Date.add(this.viewStart,{days:s})}))}for(var t=0,f=0,e=[],a=u.length,nt,i,r;t<a;t++)for(n=u[t].data,i=null,r=n[Extensible.calendar.data.EventMappings.StartDate.name].getDate(),f=0;f<a;f++)t!==f&&(i=u[f].data,this.isOverlapping(n,i)&&(n._overlap=n._overlap===undefined?1:n._overlap+1,t<f&&(n._overcol===undefined&&(n._overcol=0),i._overcol=n._overcol+1,e[r]=e[r]?Math.max(e[r],i._overcol):i._overcol)));for(t=0;t<a;t++)n=u[t].data,r=n[Extensible.calendar.data.EventMappings.StartDate.name].getDate(),n._overlap!==undefined&&(o=100/(e[r]+1),w=100-o*n._overlap,n._width=o,n._left=o*n._overcol),v=this.getEventTemplate().apply(n),y=this.id+"-day-col-"+Ext.Date.format(u[t].date,"Ymd"),Ext.core.DomHelper.append(y,v);this.fireEvent("eventsrendered",this)},getDayEl:function(n){return Ext.get(this.getDayId(n))},getDayId:function(n){return Ext.isDate(n)&&(n=Ext.Date.format(n,"Ymd")),this.id+this.dayColumnElIdDelimiter+n},getDaySize:function(){var n=this.el.down(".ext-cal-day-col-inner").getBox();return{height:n.height,width:n.width}},getDayAt:function(n,t){var w=".ext-cal-body-ct",l=this.el.down(".ext-cal-day-times").getWidth(),i=this.el.getBox(),h=this.getDaySize(!1),a=n-i.x-l,y=Math.floor(a/h.width),s=this.el.getScroll(),v=this.el.down(".ext-cal-bg-row"),r=v.getHeight()/this.incrementsPerHour,p=t-i.y-r+s.top,e=Math.max(0,Math.ceil(p/r)),c=e*(this.hourIncrement/this.incrementsPerHour),o=Extensible.Date.add(this.viewStart,{days:y,minutes:c,hours:this.viewStartHour}),u=this.getDayEl(o),f=n;return u&&(f=u.getLeft()),{date:o,el:u,timeBox:{x:f,y:e*this.hourHeight/this.incrementsPerHour+i.y-s.top,width:h.width,height:r}}},onClick:function(n){var i,u,r;if(!this.dragPending&&!Extensible.calendar.view.DayBody.superclass.onClick.apply(this,arguments)&&n.getTarget(".ext-cal-day-times",3)===null){if(i=n.getTarget("td",3),i&&i.id&&i.id.indexOf(this.dayElIdDelimiter)>-1){u=this.getDateFromId(i.id,this.dayElIdDelimiter);this.onDayClick(Ext.Date.parseDate(u,"Ymd"),!0,Ext.get(this.getDayId(u)));return}if(r=this.getDayAt(n.getX(),n.getY()),r&&r.date)this.onDayClick(r.date,!1,null)}},isActiveView:function(){var n=this.ownerCalendarPanel;return n&&n.getActiveView().isDayView}}),Ext.define("Extensible.calendar.view.Day",{extend:"Ext.Container",alias:"widget.extensible.dayview",requires:["Extensible.calendar.view.AbstractCalendar","Extensible.calendar.view.DayHeader","Extensible.calendar.view.DayBody"],showTime:!0,showTodayText:!0,dayCount:1,enableEventResize:!0,ddIncrement:30,minEventDisplayMinutes:30,showHourSeparator:!0,viewStartHour:0,viewEndHour:24,scrollStartHour:7,hourHeight:42,hideMode:"offsets",minBodyHeight:150,isDayView:!0,initComponent:function(){var n,i,t;this.ddCreateEventText=this.ddCreateEventText||Extensible.calendar.view.AbstractCalendar.prototype.ddCreateEventText,this.ddMoveEventText=this.ddMoveEventText||Extensible.calendar.view.AbstractCalendar.prototype.ddMoveEventText,this.dayCount=this.dayCount>7?7:this.dayCount<1?1:this.dayCount,n=Ext.apply({},this.initialConfig),n.showTime=this.showTime,n.showTodayText=this.showTodayText,n.todayText=this.todayText,n.dayCount=this.dayCount,n.weekCount=1,n.readOnly=this.readOnly,n.ddIncrement=this.ddIncrement,n.minEventDisplayMinutes=this.minEventDisplayMinutes,i=Ext.applyIf({xtype:"extensible.dayheaderview",id:this.id+"-hd",ownerCalendarPanel:this.ownerCalendarPanel},n),t=Ext.applyIf({xtype:"extensible.daybodyview",enableEventResize:this.enableEventResize,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,scrollStartHour:this.scrollStartHour,hourHeight:this.hourHeight,id:this.id+"-bd",ownerCalendarPanel:this.ownerCalendarPanel},n),this.items=[i,t],this.addCls("ext-cal-dayview ext-cal-ct"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.header=Ext.getCmp(this.id+"-hd"),this.body=Ext.getCmp(this.id+"-bd");this.body.on("eventsrendered",this.forceSize,this);this.on("resize",this.onResize,this)},refresh:function(n){Extensible.log("refresh (DayView)"),n===undefined&&(n=!1),this.header.refresh(n),this.body.refresh(n)},forceSize:function(){var n=this;Ext.defer(function(){var i=n.el.up(".x-panel-body"),r=n.el.down(".ext-cal-day-header"),t=i?i.getHeight()-r.getHeight():!1;t&&(t<n.minBodyHeight?(t=n.minBodyHeight,n.addCls("ext-cal-overflow-y")):n.removeCls("ext-cal-overflow-y"),n.el.down(".ext-cal-body-ct").setHeight(t-1))},Ext.isIE?1:0,n)},onResize:function(){this.forceSize(),Ext.defer(this.refresh,Ext.isIE?1:0,this)},doHide:function(){this.header.doHide.apply(this,arguments),this.body.doHide.apply(this,arguments)},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(n){this.header.setStartDate(n,!1),this.body.setStartDate(n,!0)},renderItems:function(){this.header.renderItems(),this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(n){var n=this.header.moveTo(n,!1);return this.body.moveTo(n,!0),this.forceSize(),n},moveNext:function(){var n=this.header.moveNext(!1);return this.body.moveNext(!0),this.forceSize(),n},movePrev:function(){var t=this.header.movePrev(!1);return this.body.movePrev(!0),this.forceSize(),t},moveDays:function(n){var t=this.header.moveDays(n,!1);return this.body.moveDays(n,!0),this.forceSize(),t},moveToday:function(){var n=this.header.moveToday(!1);return this.body.moveToday(!0),this.forceSize(),n},showEventEditor:function(){return Extensible.calendar.view.AbstractCalendar.prototype.showEventEditor.apply(this,arguments)},dismissEventEditor:function(){return Extensible.calendar.view.AbstractCalendar.prototype.dismissEventEditor.apply(this,arguments)}}),Ext.define("Extensible.calendar.view.MultiDay",{extend:"Extensible.calendar.view.Day",alias:"widget.extensible.multidayview",dayCount:3,startDayIsStatic:!1,moveNext:function(n){return this.moveDays(this.startDayIsStatic?7:this.dayCount,n)},movePrev:function(n){return this.moveDays(this.startDayIsStatic?-7:-this.dayCount,n)}}),Ext.define("Extensible.calendar.view.Week",{extend:"Extensible.calendar.view.MultiDay",alias:"widget.extensible.weekview",dayCount:7}),Ext.define("Extensible.calendar.view.MultiWeek",{extend:"Extensible.calendar.view.Month",alias:"widget.extensible.multiweekview",weekCount:2,moveNext:function(){return this.moveWeeks(this.weekCount,!0)},movePrev:function(){return this.moveWeeks(-this.weekCount,!0)}}),Ext.define("Extensible.calendar.CalendarPanel",{extend:"Ext.panel.Panel",alias:"widget.extensible.calendarpanel",requires:["Ext.layout.container.Card","Extensible.calendar.view.Day","Extensible.calendar.view.Week","Extensible.calendar.view.Month","Extensible.calendar.view.MultiDay","Extensible.calendar.view.MultiWeek"],recurrence:!1,showDayView:!0,showMultiDayView:!1,showWeekView:!0,showMultiWeekView:!0,showMonthView:!0,showNavBar:!0,todayText:"Today",showTodayText:!0,showTime:!0,readOnly:!1,showNavToday:!0,showNavJump:!0,showNavNextPrev:!0,jumpToText:"Jump to:",goText:"Go",dayText:"Day",multiDayText:"{0} Days",weekText:"Week",multiWeekText:"{0} Weeks",monthText:"Month",editModal:!1,enableEditDetails:!0,layout:{type:"card",deferredRender:!0},startDate:new Date,initComponent:function(){var e,o,h,s,f,t,n,r,i,u;this.tbar={cls:"ext-cal-toolbar",border:!0,items:[]},this.viewCount=0,o=this.multiDayViewCfg&&this.multiDayViewCfg.dayCount||3,h=this.multiWeekViewCfg&&this.multiWeekViewCfg.weekCount||2,this.showNavToday&&this.tbar.items.push({id:this.id+"-tb-today",text:this.todayText,handler:this.onTodayClick,scope:this}),this.showNavNextPrev&&(this.tbar.items.push({id:this.id+"-tb-prev",handler:this.onPrevClick,scope:this,iconCls:"x-tbar-page-prev"}),this.tbar.items.push({id:this.id+"-tb-next",handler:this.onNextClick,scope:this,iconCls:"x-tbar-page-next"})),this.showNavJump&&(this.tbar.items.push(this.jumpToText),this.tbar.items.push({id:this.id+"-tb-jump-dt",xtype:"datefield",width:120,showToday:!1}),this.tbar.items.push({id:this.id+"-tb-jump",text:this.goText,handler:this.onJumpClick,scope:this})),this.tbar.items.push("->"),this.showDayView&&(this.tbar.items.push({id:this.id+"-tb-day",text:this.dayText,handler:this.onDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showMultiDayView&&(e=Ext.String.format(this.getMultiDayText(o),o),this.tbar.items.push({id:this.id+"-tb-multiday",text:e,handler:this.onMultiDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showWeekView&&(this.tbar.items.push({id:this.id+"-tb-week",text:this.weekText,handler:this.onWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showMultiWeekView&&(e=Ext.String.format(this.getMultiWeekText(h),h),this.tbar.items.push({id:this.id+"-tb-multiweek",text:e,handler:this.onMultiWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),(this.showMonthView||this.viewCount===0)&&(this.tbar.items.push({id:this.id+"-tb-month",text:this.monthText,handler:this.onMonthNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++,this.showMonthView=!0),s=this.viewCount-1,this.activeItem=this.activeItem===undefined?s:this.activeItem>s?s:this.activeItem,this.showNavBar===!1&&(delete this.tbar,this.addCls("x-calendar-nonav")),this.callParent(arguments),this.addEvents({eventadd:!0,eventupdate:!0,beforeeventdelete:!0,eventdelete:!0,eventcancel:!0,viewchange:!0,editdetails:!0}),this.addCls("x-cal-panel"),this.eventStore&&(this.store=this.eventStore,delete this.eventStore),this.setStore(this.store),f={showToday:this.showToday,todayText:this.todayText,showTodayText:this.showTodayText,showTime:this.showTime,readOnly:this.readOnly,recurrence:this.recurrence,store:this.store,calendarStore:this.calendarStore,editModal:this.editModal,enableEditDetails:this.enableEditDetails,ownerCalendarPanel:this},this.showDayView&&(t=Ext.apply({xtype:"extensible.dayview",title:this.dayText},f),t=Ext.apply(Ext.apply(t,this.viewConfig),this.dayViewCfg),t.id=this.id+"-day",this.initEventRelay(t),this.add(t)),this.showMultiDayView&&(n=Ext.apply({xtype:"extensible.multidayview",title:this.getMultiDayText(o)},f),n=Ext.apply(Ext.apply(n,this.viewConfig),this.multiDayViewCfg),n.id=this.id+"-multiday",this.initEventRelay(n),this.add(n)),this.showWeekView&&(r=Ext.applyIf({xtype:"extensible.weekview",title:this.weekText},f),r=Ext.apply(Ext.apply(r,this.viewConfig),this.weekViewCfg),r.id=this.id+"-week",this.initEventRelay(r),this.add(r)),this.showMultiWeekView&&(i=Ext.applyIf({xtype:"extensible.multiweekview",title:this.getMultiWeekText(h)},f),i=Ext.apply(Ext.apply(i,this.viewConfig),this.multiWeekViewCfg),i.id=this.id+"-multiweek",this.initEventRelay(i),this.add(i)),this.showMonthView&&(u=Ext.applyIf({xtype:"extensible.monthview",title:this.monthText,listeners:{weekclick:{fn:function(n,t){this.showWeek(t)},scope:this}}},f),u=Ext.apply(Ext.apply(u,this.viewConfig),this.monthViewCfg),u.id=this.id+"-month",this.initEventRelay(u),this.add(u)),this.add(Ext.applyIf({xtype:"extensible.eventeditform",id:this.id+"-edit",calendarStore:this.calendarStore,recurrence:this.recurrence,listeners:{eventadd:{scope:this,fn:this.onEventAdd},eventupdate:{scope:this,fn:this.onEventUpdate},eventdelete:{scope:this,fn:this.onEventDelete},eventcancel:{scope:this,fn:this.onEventCancel}}},this.editViewCfg))},initEventRelay:function(n){n.listeners=n.listeners||{},n.listeners.afterrender={fn:function(n){this.relayEvents(n,["eventsrendered","eventclick","dayclick","eventover","eventout","beforedatechange","datechange","rangeselect","beforeeventcopy","eventcopy","beforeeventmove","eventmove","initdrag","dayover","dayout","beforeeventresize","eventresize","eventadd","eventupdate","beforeeventdelete","eventdelete","eventcancel","eventexception"]);n.on("editdetails",this.onEditDetails,this)},scope:this,single:!0}},afterRender:function(){this.callParent(arguments),this.body.addCls("x-cal-body"),this.updateNavState(),this.setActiveView()},getMultiDayText:function(){return this.multiDayText},getMultiWeekText:function(){return this.multiWeekText},setStore:function(n,t){var i=this.store;if(!t&&i&&i.un("write",this.onWrite,this),n)n.on("write",this.onWrite,this);this.store=n},onStoreAdd:function(){this.hideEditForm()},onStoreUpdate:function(n,t,i){i===Ext.data.Record.COMMIT&&this.hideEditForm()},onStoreRemove:function(){this.hideEditForm()},onWrite:function(n,t){var i=t.records[0];switch(t.action){case"create":this.onStoreAdd(n,i);break;case"update":this.onStoreUpdate(n,i,Ext.data.Record.COMMIT);break;case"destroy":this.onStoreRemove(n,i)}},onEditDetails:function(n,t,i){this.fireEvent("editdetails",this,n,t,i)!==!1&&this.showEditForm(t)},save:function(){this.store.autoSync||this.store.sync()},onEventAdd:function(n,t){t.store||(this.store.add(t),this.save()),this.fireEvent("eventadd",this,t)},onEventUpdate:function(n,t){this.save(),this.fireEvent("eventupdate",this,t)},onEventDelete:function(n,t){this.store.remove(t),this.save(),this.fireEvent("eventdelete",this,t)},onEventCancel:function(n,t){this.hideEditForm(),this.fireEvent("eventcancel",this,t)},showEditForm:function(n){return this.preEditView=this.layout.getActiveItem().id,this.setActiveView(this.id+"-edit"),this.layout.getActiveItem().loadRecord(n),this},hideEditForm:function(){return this.preEditView&&(this.setActiveView(this.preEditView),delete this.preEditView),this},setActiveView:function(n,t){var i=this,r=i.layout,f=i.id+"-edit",u;t&&(i.startDate=t),n!==r.getActiveItem().id&&(u=i.getDockedItems("toolbar")[0],u&&u[n===f?"hide":"show"](),r.setActiveItem(n||i.activeItem),i.doComponentLayout(),i.activeView=r.getActiveItem(),n!==f&&(n&&n!==i.preEditView&&r.activeItem.setStartDate(i.startDate,!0),i.updateNavState()),i.fireViewChange())},fireViewChange:function(){var n,t,r,i;this.layout&&this.layout.getActiveItem&&(n=this.layout.getActiveItem(),t=Ext.Date.clone,n&&(n.getViewBounds&&(i=n.getViewBounds(),r={viewStart:t(i.start),viewEnd:t(i.end),activeDate:t(n.getStartDate())}),n.dismissEventEditor&&n.dismissEventEditor(),this.fireEvent("viewchange",this,n,r)))},updateNavState:function(){var n=this,t=n.layout.activeItem,r,i;t&&n.showNavBar!==!1&&(r=t.id.split(n.id+"-")[1],i=Ext.getCmp(n.id+"-tb-"+r),n.showNavToday&&Ext.getCmp(n.id+"-tb-today").setDisabled(t.isToday()),i.toggle(!0))},setStartDate:function(n){return Extensible.log("setStartDate (CalendarPanel"),this.startDate=n,this.layout.activeItem.setStartDate(n,!0),this.updateNavState(),this.fireViewChange(),this},showWeek:function(n){this.setActiveView(this.id+"-week",n)},onTodayClick:function(){this.startDate=this.layout.activeItem.moveToday(!0),this.updateNavState(),this.fireViewChange()},onJumpClick:function(){var n=Ext.getCmp(this.id+"-tb-jump-dt").getValue();n!==""&&(this.startDate=this.layout.activeItem.moveTo(n,!0),this.updateNavState(),this.fireViewChange())},onPrevClick:function(){this.startDate=this.layout.activeItem.movePrev(!0),this.updateNavState(),this.fireViewChange()},onNextClick:function(){this.startDate=this.layout.activeItem.moveNext(!0),this.updateNavState(),this.fireViewChange()},onDayNavClick:function(){this.setActiveView(this.id+"-day")},onMultiDayNavClick:function(){this.setActiveView(this.id+"-multiday")},onWeekNavClick:function(){this.setActiveView(this.id+"-week")},onMultiWeekNavClick:function(){this.setActiveView(this.id+"-multiweek")},onMonthNavClick:function(){this.setActiveView(this.id+"-month")},getActiveView:function(){return this.layout.activeItem}});
/*!
 * Extensible 1.5.1
 * Copyright(c) 2010-2011 Extensible, LLC
 * licensing@ext.ensible.com
 * http://ext.ensible.com
 */
Ext.onReady(function(){var t=Ext.ClassManager,n=Ext.Function.bind(t.get,t);Ext.Updater&&(Ext.Updater.defaults.indicatorText='<div class="loading-indicator">Carregando...</div>'),n("Ext.view.View")&&(Ext.view.View.prototype.emptyText=""),n("Ext.grid.Panel")&&(Ext.grid.Panel.prototype.ddText="{0} linha(s) selecionada(s)"),Ext.TabPanelItem&&(Ext.TabPanelItem.prototype.closeText="Fechar"),n("Ext.form.field.Base")&&(Ext.form.field.Base.prototype.invalidText="O valor para este campo &eacute; inv&aacute;lido"),Ext.LoadMask&&(Ext.LoadMask.prototype.msg="Carregando..."),Ext.Date&&(Ext.Date.monthNames=["Janeiro","Fevereiro","Mar&ccedil;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],Ext.Date.getShortMonthName=function(n){return Ext.Date.monthNames[n].substring(0,3)},Ext.Date.monthNumbers={Jan:0,Fev:1,Mar:2,Abr:3,Mai:4,Jun:5,Jul:6,Ago:7,Set:8,Out:9,Nov:10,Dez:11},Ext.Date.getMonthNumber=function(n){return Ext.Date.monthNumbers[n.substring(0,1).toUpperCase()+n.substring(1,3).toLowerCase()]},Ext.Date.dayNames=["Domingo","Segunda","Ter&ccedil;a","Quarta","Quinta","Sexta","S&aacute;bado"]),Ext.MessageBox&&(Ext.MessageBox.buttonText={ok:"OK",cancel:"Cancelar",yes:"Sim",no:"N&atilde;o"}),n("Ext.util.Format")&&(Ext.apply(Ext.util.Format,{thousandSeparator:",",decimalSeparator:".",currencySign:"R$",dateFormat:"d/m/Y"}),Ext.util.Format.brMoney=Ext.util.Format.currency),n("Ext.picker.Date")&&Ext.apply(Ext.picker.Date.prototype,{todayText:"Hoje",minText:"Esta data &eacute; anterior a menor data",maxText:"Esta data &eacute; posterior a maior data",disabledDaysText:"",disabledDatesText:"",monthNames:Ext.Date.monthNames,dayNames:Ext.Date.dayNames,nextText:"Pr&oacute;ximo M&ecirc;s (Control+Direita)",prevText:"M&ecirc;s Anterior (Control+Esquerda)",monthYearText:"Escolha um M&ecirc;s (Control+Cima/Baixo para mover entre os anos)",todayTip:"{0} (Espa&ccedil;o)",format:"d/m/Y",startDay:0}),n("Ext.picker.Month")&&Ext.apply(Ext.picker.Month.prototype,{okText:"&#160;OK&#160;",cancelText:"Cancelar"}),n("Ext.toolbar.Paging")&&Ext.apply(Ext.PagingToolbar.prototype,{beforePageText:"P&aacute;gina",afterPageText:"de {0}",firstText:"Primeira P&aacute;gina",prevText:"P&aacute;gina Anterior",nextText:"Pr&oacute;xima P&aacute;gina",lastText:"&Uacute;ltima P&aacute;gina",refreshText:"Atualizar",displayMsg:"<b>{0} &agrave; {1} de {2} registro(s)</b>",emptyMsg:"Sem registros para exibir"}),n("Ext.form.field.Text")&&Ext.apply(Ext.form.field.Text.prototype,{minLengthText:"O tamanho m&iacute;nimo para este campo &eacute; {0}",maxLengthText:"O tamanho m&aacute;ximo para este campo &eacute; {0}",blankText:"Este campo &eacute; obrigat&oacute;rio.",regexText:"",emptyText:null}),n("Ext.form.field.Number")&&Ext.apply(Ext.form.field.Number.prototype,{minText:"O valor m&iacute;nimo para este campo &eacute; {0}",maxText:"O valor m&aacute;ximo para este campo &eacute; {0}",nanText:"{0} n&atilde;o &eacute; um n&uacute;mero v&aacute;lido"}),n("Ext.form.field.Date")&&Ext.apply(Ext.form.field.Date.prototype,{disabledDaysText:"Desabilitado",disabledDatesText:"Desabilitado",minText:"A data deste campo deve ser posterior a {0}",maxText:"A data deste campo deve ser anterior a {0}",invalidText:"{0} n&atilde;o &eacute; uma data v&aacute;lida - deve ser informado no formato {1}",format:"d/m/Y"}),n("Ext.form.field.ComboBox")&&(Ext.apply(Ext.form.field.ComboBox.prototype,{valueNotFoundText:undefined}),Ext.apply(Ext.form.field.ComboBox.prototype.defaultListConfig,{loadingText:"Carregando..."})),n("Ext.form.field.VTypes")&&Ext.apply(Ext.form.field.VTypes,{emailText:'Este campo deve ser um endere&ccedil;o de e-mail v&aacute;lido, no formato "usuario@dominio.com.br"',urlText:'Este campo deve ser uma URL no formato "http://www.dominio.com.br"',alphaText:"Este campo deve conter apenas letras e _",alphanumText:"Este campo deve conter apenas letras, n&uacute;meros e _"}),n("Ext.form.field.HtmlEditor")&&Ext.apply(Ext.form.field.HtmlEditor.prototype,{createLinkText:"Por favor, entre com a URL do link:",buttonTips:{bold:{title:"Negrito (Ctrl+B)",text:"Deixa o texto selecionado em negrito.",cls:Ext.baseCSSPrefix+"html-editor-tip"},italic:{title:"It&aacute;lico (Ctrl+I)",text:"Deixa o texto selecionado em it&aacute;lico.",cls:Ext.baseCSSPrefix+"html-editor-tip"},underline:{title:"Sublinhado (Ctrl+U)",text:"Sublinha o texto selecionado.",cls:Ext.baseCSSPrefix+"html-editor-tip"},increasefontsize:{title:"Aumentar Texto",text:"Aumenta o tamanho da fonte.",cls:Ext.baseCSSPrefix+"html-editor-tip"},decreasefontsize:{title:"Diminuir Texto",text:"Diminui o tamanho da fonte.",cls:Ext.baseCSSPrefix+"html-editor-tip"},backcolor:{title:"Cor de Fundo",text:"Muda a cor do fundo do texto selecionado.",cls:Ext.baseCSSPrefix+"html-editor-tip"},forecolor:{title:"Cor da Fonte",text:"Muda a cor do texto selecionado.",cls:Ext.baseCSSPrefix+"html-editor-tip"},justifyleft:{title:"Alinhar &agrave; Esquerda",text:"Alinha o texto &agrave; esquerda.",cls:Ext.baseCSSPrefix+"html-editor-tip"},justifycenter:{title:"Centralizar Texto",text:"Centraliza o texto no editor.",cls:Ext.baseCSSPrefix+"html-editor-tip"},justifyright:{title:"Alinhar &agrave; Direita",text:"Alinha o texto &agrave; direita.",cls:Ext.baseCSSPrefix+"html-editor-tip"},insertunorderedlist:{title:"Lista com Marcadores",text:"Inicia uma lista com marcadores.",cls:Ext.baseCSSPrefix+"html-editor-tip"},insertorderedlist:{title:"Lista Numerada",text:"Inicia uma lista numerada.",cls:Ext.baseCSSPrefix+"html-editor-tip"},createlink:{title:"Link",text:"Transforma o texto selecionado em um link.",cls:Ext.baseCSSPrefix+"html-editor-tip"},sourceedit:{title:"Editar Fonte",text:"Troca para o modo de edi&ccedil;&atilde;o de c&oacute;digo fonte.",cls:Ext.baseCSSPrefix+"html-editor-tip"}}}),n("Ext.grid.header.Container")&&Ext.apply(Ext.grid.header.Container.prototype,{sortAscText:"Ordem Ascendente",sortDescText:"Ordem Descendente",lockText:"Bloquear Coluna",unlockText:"Desbloquear Coluna",columnsText:"Colunas"}),n("Ext.grid.PropertyColumnModel")&&Ext.apply(Ext.grid.PropertyColumnModel.prototype,{nameText:"Nome",valueText:"Valor",dateFormat:"d/m/Y"})});$().ready(function(){$("#divFormEvent").modal({show:!1,backdrop:"static"}),$("#btnReserveLocal").click(function(){$("#reservedLocals").append('<div class="row" style="position:relative;">                     <a class="icon-remove-circle icon-large pull-left removeLocal" style="cursor:pointer; position:absolute; top:50%;" title="Remover reserva"></a>                     <div class="span3">                         <label>Local</label>                         <select class="span3"> </select>                     </div>                     <div class="span1" style="width:95px;">                         <label>Dia</label>                         <input type="text" name="reserveDate" class="dateField span1" />                     </div>                     <div class="span2">                         <label style="width:100%;font-size:12px;">&nbsp;</label>                         <div class="btn-group clearfix" data-toggle="buttons-checkbox">                             <button type="button" name="timeMorning" class="btn btn-small">Manhã</button>                             <button type="button" name="timeAfternoon" class="btn btn-small">Tarde</button>                             <button type="button" name="timeEvening" class="btn btn-small">Noite</button>                         </div>                     </div>                 </div>').show("slow"),$(".removeLocal").click(function(){$(this).effect("highlight",{},3e3),$(this).closest("div").remove()}),$.each($(".dateField"),function(){$(this).datepicker({prevText:"",nextText:""})}),$('button[name="timeMorning"]').tooltip({placement:"top",title:"6h às 12h"}),$('button[name="timeAfternoon"]').tooltip({placement:"top",title:"12h às 18h"}),$('button[name="timeEvening"]').tooltip({placement:"top",title:"18h às 22h"})}),setDateTimePicker()})